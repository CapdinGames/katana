{% extends 'layout.html' %}
{% import 'forms.html' as forms %}
{% from 'build_line.html' import build_table %}
{% from "box_macros.html" import box %}
{% import 'submenu.html' as submenu %}

{% set bodyId = 'id="buildqueue_page"' %}
{% set dataRealtimerServer = realTimeServer %}

{% block submenu %}
  {{submenu.buildsubmenu_buildqueue(active_page='buildqueue', pathNum=1)}}
{% endblock %}

{% block content %}
<div id="formWrapper">
    <button id="submitBtn" class="grey-btn var-2 m-bottom15">Remove selected</button>
    
<form method="post" name="cancel_build" action={{ path_to_root+"buildqueue/_selected/cancelselected" }} >
    <!--
    
        <input class="grey-btn var-2 fl-right m-bottom15" type="submit" value="Remove selected" />
    -->
<table id="tablesorter" class="table-1 first-child tablesorter tablesorter-js tools-js">
<thead>
    <tr>
        <th class="txt-align-left">Builder</th>
        <th class="txt-align-left">Codebases</th>
        <th class="txt-align-left">Reason</th>
        <th class="txt-align-right">Compatible slaves</th>
        <th class="select-input no-tablesorter-js">
            <label for="selectall">
                Select all
            </label>
            <input id="selectall" type="checkbox" name="checkuncheck" />
        </th>
    </tr>
</thead>
<tbody>

</tbody>
</table>

        
<table id="tablesorter" class="table-1 first-child tablesorter tablesorter-j tools-js">
    <thead>
    <tr>
        <th class="txt-align-left">Builder</th>
        <th class="txt-align-left">Codebases</th>
        <th class="txt-align-left">Reason</th>
        <th class="txt-align-right">Compatible slaves</th>
        <th class="select-input no-tablesorter-js">
            <label for="selectall">
                Select all
            </label>
            <input id="selectall" type="checkbox" name="checkuncheck" />
        </th>
    </tr>
    </thead>
    <tbody>
    {% for bq in buildqueue %}
    <tr>
        <td class="txt-align-left">
            {{ bq.name }} 
        </td>
        <td class="txt-align-left">

            <a class="more-info popup-btn-js-2 mod-1" href="#" data-att="">
              {{bq.sourcestamps|length}} Codebase 
            </a>
             <div class="more-info-box more-info-box-js">
              <span class="close-btn">
              </span>
              <h3>Codebases</h3>
              <table class="table-1 first-child">
                <thead>
                    <th class="txt-align-left">
                        Codebase
                    </th>
                    <th class="txt-align-left">
                        Repository
                    </th>
                    <th class="txt-align-left">
                        Branch
                    </th>
                    <th class="txt-align-left">
                        Revision
                    </th>
                </thead>
                    <tbody>
                        {% for sskey, value in bq.sourcestamps.iteritems() %}
                            <tr>
                                <td class="txt-align-left">
                                    {% if sskey %}
                                        {{sskey}}
                                    {% else %} 
                                        &nbsp;
                                    {% endif %}
                                </td>
                                <td class="txt-align-left">
                                    {% if value.repository %}
                                        {{value.repository}}
                                    {% else %} 
                                        &nbsp;
                                    {% endif %}
                                </td>
                                <td class="txt-align-left">
                                    {% if value.branch %}
                                        {{value.branch}}
                                    {% else %} 
                                        &nbsp;
                                    {% endif %}
                                </td>
                                <td class="txt-align-left">
                                    {% if value.revision %}
                                        {{value.revision}}
                                    {% else %} 
                                        &nbsp;
                                    {% endif %}  
                                    
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
            </div>
        </td>

        <td class="txt-align-left">
            <ul class="codebases-list">
                <li class="reason-txt">
                    {{ bq.reason }}
                </li> 
                <li>
                    requested on {{ bq.when }}
                </li>
                <li>
                    waiting {{ bq.waiting }} 
                </li>
            </ul>
        </td>
        <td class="txt-align-right">
            <a class="more-info popup-btn-js-2 mod-1" href="#">
              {{ bq.slaves|length }} slaves
            </a>
             <div class="more-info-box more-info-box-js">
              <span class="close-btn">
              </span>
              <h3>Compatible slaves</h3>
                
                <ul class="codebases-list">
                {% for slave in bq.slaves %}
                    <li> 
                        <a href="{{ path_to_root + 'buildslaves/' + slave }}">
                            {{slave}}
                        </a> 
                    </li>
                {% endfor %}
                </ul>
            </div>
        </td>
        <td class="select-input">
            <input class="fi-js fi" type="checkbox" name="cancelselected" value="{{ bq.brid }}"/><br/>
            <a title="Remove this build" class="force-individual-js delete-icon" href="#"></a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
 </form>
 </div>
{% endblock %}