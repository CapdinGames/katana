{% extends 'layout.html' %}
{% import 'forms.html' as forms %}
{% from 'build_line.html' import build_table %}
{% from "box_macros.html" import box %}
{% import 'submenu.html' as submenu %}

{% block submenu %}
  {{submenu.buildsubmenu_buildqueue(active_page='buildqueue', pathNum=1)}}
{% endblock %}

{% block content %}
<div id="formWrapper">
<form method="post" name="cancel_build" action={{ path_to_root+"buildqueue/_selected/cancelselected" }} >
    <input class="grey-btn var-2 fl-right m-bottom15" type="submit" value="Remove selected" />

<table class="table-1 first-child">
    <thead>
    <tr>
        <th class="txt-align-left">Builder</th>
        <th class="txt-align-left">Project</th>
        <th class="txt-align-left">Repository</th>
        <th class="txt-align-left">Branch</th>
        <th class="txt-align-left">Revision</th>
        <th class="txt-align-left">Reason</th>
        <th class="txt-align-left">Compatible slaves</th>
        <th><input id="selectall" type="checkbox" name="checkuncheck" /></th>
    </tr>
    </thead>
    <tbody>
    {% for bq in buildqueue %}
    <tr>
        <td class="txt-align-left">
            {{ bq.name }} 
        </td>
        <td class="txt-align-left">
        {% for sskey, value in bq.sourcestamps.iteritems() %}
            {{sskey}}
        {% endfor %}
        </td>

        <td class="txt-align-left">
            <div class="ellipsis ellipsis-js">
                {% for sskey, value in bq.sourcestamps.iteritems() %}
                    {{value.repository}}
                {% endfor %}
            </div>
        </td>

        <td class="txt-align-left">
            {% for sskey, value in bq.sourcestamps.iteritems() %}
                {{value.branch}}
            {% endfor %}
        </td>

        <td class="txt-align-left">
            {% for sskey, value in bq.sourcestamps.iteritems() %}
                {% if value.revision %}
                    {{value.revision}}
                {% endif %}
            {% endfor %}
        </td>

        <td class="txt-align-left">
            <ul class="codebases-list">

                <li>
                    {{ bq.reason }}
                </li> 
                <li>
                    requested on {{ bq.when }}
                </li>
                <li>
                    waiting {{ bq.waiting }} 
                </li>
            </ul>
        </td>
        <td class="txt-align-left">
            <a class="more-info popup-btn-js mod-1" href="#">
              {{ bq.slaves|length }} slaves
            </a>
             <div class="more-info-box more-info-box-js">
              <span class="close-btn">
              </span>
              <h3>Compatible slaves</h3>
                
                <ul class="codebases-list">
                {% for slave in bq.slaves %}
                    <li> 
                        <a href="{{ path_to_root + 'buildslaves/' + slave }}">
                            {{slave}}
                        </a> 
                    </li>
                {% endfor %}
                </ul>
            </div>
        </td>
        <td>
            <input class="fi-js fi" type="checkbox" name="cancelselected" value="{{ bq.brid }}"/><br/>
            <a title="Remove this build" class="force-individual-js delete-icon" href="#"></a>
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>
 </form>
 </div>
{% endblock %}