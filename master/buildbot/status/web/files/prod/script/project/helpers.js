define(["jquery","screensize","text!templates/popups.mustache","mustache","extend-moment","timeElements"],function(e,t,n,r,i,s){var o,u={},a={SUCCESS:[0,"success"],WARNINGS:[1,"warnings"],FAILURE:[2,"failure"],SKIPPED:[3,"skipped"],EXCEPTION:[4,"exception"],RETRY:[5,"retry"],CANCELED:[6,"exception"],NOT_REBUILT:[7,"not_rebuilt"],DEPENDENCY_FAILURE:[8,"dependency_failure"],RUNNING:[9,"running"],NOT_STARTED:[10,"not_started"],None:""};return e.each(a,function(e,t){u[e]=t[0]}),String.prototype.format=function(){var e=arguments;return this.replace(/\{(\d+)\}/g,function(t,n){return e[n]!==undefined?e[n]:t})},Number.prototype.clamp=function(e,t){return Math.min(Math.max(this,e),t)},o={init:function(){o.setCurrentItem(),o.authorizeUser(),e("#buildslave_page").length&&o.displaySum(e("#currentJobs"),e("#runningBuilds_onBuildslave").find("li")),o.menuItemWidth(t.isMediumScreen()),e(window).resize(function(){o.menuItemWidth(t.isMediumScreen())}),e(function(){var n=/chrome/.test(navigator.userAgent.toLowerCase()),r=/firefox/.test(navigator.userAgent.toLowerCase()),i=navigator.platform.toUpperCase().indexOf("WIN")!==-1;n&&e("body").addClass("chrome"),i&&e("body").addClass("win"),r&&e("body").addClass("firefox")}),o.toolTip(".ellipsis-js"),o.parseReasonString(),e("#authUserBtn").click(function(){o.eraseCookie("fullName1","","eraseCookie")}),o.tooltip(e(".tooltip"))},randomImage:function(e){var t=["48273828.jpg"];e.attr("src","images/"+t[Math.floor(Math.random()*t.length)])},tooltip:function(n){n.hover(function(n){var r=e(this),i=e('<div class="tooltip-cont" />');this.t=this.title,this.title="";var s=n.pageY+20,o=n.pageX+5;e(n.target).click(function(){i.remove()}),t.isMediumScreen()&&r.hasClass("responsive-tooltip")?i.html(this.t).appendTo("body").css({top:s,right:28}).fadeIn("fast"):i.html(this.t).appendTo("body").css({top:s,left:o}).fadeIn("fast")},function(){this.title=this.t;var t=e(".tooltip-cont");t.fadeOut("fast",function(){e(this).remove()})})},authorizeUser:function(){var e=window.location;o.getCookie("BuildBotSession")===""&&(window.location="/login")},setCurrentItem:function(){var t=window.location.pathname.split("/");e(".top-menu a").each(function(n){var r=this.href.split("/");(this.id===t[1].trim().toLowerCase()||this.id==="home"&&t[1].trim().toLowerCase().length===0)&&e(this).parent().addClass("selected")})},jCenter:function(t){var n=e(window).height(),r=e(window).width(),i=t.outerHeight(),s=t.outerWidth();return n<i+5?t.css({top:5+e(window).scrollTop()+"px",height:n-60}):t.css({top:(n-i)/2+e(window).scrollTop()+"px",height:"auto"}),t.css("left",(r-s)/2+e(window).scrollLeft()+"px"),t},parseReasonString:function(){e(".codebases-list .reason-txt").each(function(){var t=e(this).text().trim();t==="A build was forced by '':"&&e(this).remove()})},selectBuildsAction:function(t,i,s,o){function l(n){var r=t.dataTable();return e("body").append(a).show(),n+="&ajax=true",e.ajax({type:"POST",url:s,data:n,success:function(e){i===!1&&(r.fnClearTable(),r.fnAddData(e)),f.prop("checked",!1),a.remove()}}),!1}if(t===undefined){t=e("#tablesorterRt");if(t.length===0)return}var u=r.render(n,{preloader:"true"}),a=e(u),f=e("#selectall");f.click(function(){var n=t.dataTable().fnGetNodes();e(".fi-js",n).prop("checked",this.checked)}),e("#submitBtn").click(function(n){n.preventDefault();var r=t.dataTable(),i=r.fnGetNodes(),s=e(".fi-js",i),u="";s.each(function(){e(this).is(":checked")&&(u+=o+e(this).val()+"&")});var a=u.slice(0,-1);a!==""&&l(a)}),t.delegate(".force-individual-js","click",function(t){t.preventDefault();var n=e(this).prev().prev().val(),r=o+n;l(r)})},updateBuilders:function(){e.ajax({url:"/json/builders/?filter=0",dataType:"json",type:"GET",cache:!1,success:function(t){function s(t){var n=0;return e.each(t,function(){n+=parseFloat(this)||0}),n}var n=[],r=[],i=[];e.each(t,function(e,t){n.push(e),r.push(t.pendingBuilds),t.state==="building"&&i.push(t.currentBuilds)}),e("#pendingBuilds").text(s(r))}}),e.ajax({url:"/json/slaves/?filter=0",dataType:"json",type:"GET",cache:!1,success:function(t){var n=[];e.each(t,function(e){n.push(e)}),e("#slavesNr").text(n.length)}})},codeBaseBranchOverview:function(t){var n=decodeURIComponent(window.location.search),r=n.split("&"),i=e('<div class="border-table-holder col-xs-10"><div id="overScrollJS" class="inner-table-holder"><table class="codebase-branch-table"><tr class="codebase"><th>Codebase</th></tr><tr class="branch"><th>Branch</th></tr></table></div></div>');i.appendTo(t),e(r).each(function(t){var n=this.split("=");if(n[0].indexOf("_branch")>0){var r=this.split("_branch")[0];t===0&&(r=this.replace("?","").split("_branch")[0]);var i=this.split("=")[1];e("tr.codebase").append("<td>"+r+"</td>"),e("tr.branch").append("<td>"+i+"</td>")}})},menuItemWidth:function(t){if(t){var n=0;e(".breadcrumbs-nav li").each(function(){n+=e(this).outerWidth()}),e(".breadcrumbs-nav").width(n+100)}else e(".breadcrumbs-nav").width("")},toolTip:function(t){e(t).parent().hover(function(){var n=e(t,this).attr("data-txt"),r=e("<div/>").addClass("tool-tip").text(n);e(this).append(e(r).css({top:e(t,this).position().top-10,left:e(t,this).position().left-20}).show())},function(){e(".tool-tip").remove()}),e(document).bind("click touchstart",function(t){e(".tool-tip").remove(),e(this).unbind(t)})},displaySum:function(e,t){e.text(t.length)},setCookie:function(e,t,n){var r=new Date,i=new Date(r.getTime()+2592e6),s=n===undefined?i.toGMTString():"Thu, 01 Jan 1970 00:00:00 GMT;";document.cookie=e+"="+t+"; path=/; expires="+s},inDOM:function(t){return e.contains(document.documentElement,t[0])},delegateToProgressBar:function(t){e.each(t,function(t,n){var r=e(n);s.addProgressBarElem(r,r.attr("data-starttime"),r.attr("data-etatime"))})},verticalProgressBar:function(e,t){e.height("{0}%".format(t))},getTime:function(e,t){t===null&&(t=Math.round(+(new Date)/1e3));var n=t-e,r=Math.round(n),i=Math.floor(n/86400)===0?"":Math.floor(n/86400)+" days ",s=Math.floor(n/3600)===0?"":Math.floor(n/3600)%24+" hours ",o=Math.floor(r/60)===0?"":Math.floor(r/60)%60+" mins, ",u=r-Math.floor(r/60)*60+" secs ";return i+s+o+u},getResult:function(e){var t=["success","warnings","failure","skipped","exception","retry","canceled"];return t[e]},getSlavesResult:function(e,t){return e===!1?"Not connected":t.length>0?"Running":"idle"},getClassName:function(e,t){var n=o.getSlavesResult(e,t);return n==="Not connected"?"status-td offline":n==="Running"?"status-td building":"status-td idle"},getCurrentPage:function(){return document.getElementsByTagName("body")[0].id},hasfinished:function(){var t=!1,n=e("#isFinished").attr("data-isfinished");return n===undefined&&(t=!1),n===!0&&(t=!0),t},isRealTimePage:function(){var t=!1,n=["buildslaves_page","buildslavedetail_page","builderdetail_page","builddetail_page","buildqueue_page","projects_page","home_page","builders_page","jsonhelp_page","usersettings_page"],r=o.getCurrentPage();return e.each(n,function(e,n){n===r&&(t=!0)}),t},getCookie:function(e){var t=new RegExp(e+"=([^;]+)"),n=t.exec(document.cookie);return n!==null?decodeURI(n[1]):""},eraseCookie:function(e,t,n){o.setCookie(e,t,n)},closePopup:function(t,n){var r=e(".close-btn").add(document);r.bind("click touchstart",function(i){if(!e(i.target).closest(t).length||e(i.target).closest(".close-btn").length)n===undefined?t.remove():t.slideUp("fast",function(){r.unbind(i)}),r.unbind(i)})},urlHasCodebases:function(){return Object.keys(o.codebasesFromURL({})).length>0},codebasesFromURL:function(t){var n=window.location.search.substring(1),r=n.split("&");return e.each(r,function(e,n){var r=n.split("=");r[0].indexOf("_branch")>=0&&(t[r[0]]=r[1])}),t},urlParamsToString:function(t){var n=[];return e.each(t,function(e,t){n.push(e+"="+t)}),n.join("&")},getCssClassFromStatus:function(e){var t=Object.keys(a).map(function(e){return a[e]});return t[e][1]},setIFrameSize:function(e){if(e){var t=e.contentWindow||e.contentDocument.parentWindow;t.document.body&&(e.height=t.document.documentElement.scrollHeight||t.document.body.scrollHeight,e.width=t.document.documentElement.scrollWidth||t.document.body.scrollWidth)}},objectPropertiesToArray:function(e){var t=[],n;for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t},cssClassesEnum:u},o});