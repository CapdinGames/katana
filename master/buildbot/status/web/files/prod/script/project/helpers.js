define(["jquery","screensize"],function(e,t){var n;return n={init:function(){n.setCurrentItem(),n.authorizeUser(),e("#builders_page").length&&window.location.search!=""&&n.codeBaseBranchOverview(),e("#tb-root").length!=0&&n.updateBuilders(),n.menuItemWidth(t.isMediumScreen()),e(window).resize(function(){n.menuItemWidth(t.isMediumScreen())}),n.selectBuildsAction(),e(function(){var n=/chrome/.test(navigator.userAgent.toLowerCase()),r=navigator.platform.toUpperCase().indexOf("WIN")!==-1;n&&r&&e("body").addClass("chrome win")}),n.toolTip(".ellipsis-js"),n.parseReasonString(),n.runIndividualBuild(),n.setFullName(e("#buildForm .full-name-js, #authUserName")),e("#authUserBtn").click(function(e){n.eraseCookie("fullName1","","eraseCookie")})},authorizeUser:function(){var e=window.location;if(e.search.match(/user=/)&&e.search.match(/autorized=True/)){var t=decodeURIComponent(e.search.split("&").slice(0)[1].split("=")[1]);n.setCookie("fullName1",t),window.location="/"}else n.getCookie("fullName1")===""?window.location="/login":n.setCookie("fullName1",n.getCookie("fullName1"))},setCurrentItem:function(){var t=window.location.pathname.split("/");e(".top-menu a").each(function(n){var r=this.href.split("/");(this.id==t[1].trim().toLowerCase()||this.id=="home"&&t[1].trim().toLowerCase().length===0)&&e(this).parent().addClass("selected")})},jCenter:function(t){var n=e(window).height(),r=e(window).width(),i=t.outerHeight(),s=t.outerWidth();return t.css("position","absolute"),n<i?t.css("top",(n-i+(i-n)+10)/2+e(window).scrollTop()+"px"):t.css("top",(n-i)/2+e(window).scrollTop()+"px"),t.css("left",(r-s)/2+e(window).scrollLeft()+"px"),t},setFullName:function(t){var r,i=n.getCookie("fullName1");t.each(function(){r=e(this).is("input")?"val":"text",e(this)[r](i)})},runIndividualBuild:function(){e(".run-build-js").click(function(t){e(".remove-js").remove(),t.preventDefault();var r=e(this).prev().attr("data-b"),i=e(this).prev().attr("data-indexb"),s='<div id="bowlG"><div id="bowl_ringG"><div class="ball_holderG"><div class="ballG"></div></div></div></div>';e("body").append(s).show(),e.get("",{rt_update:"extforms",datab:r,dataindexb:i}).done(function(t){e("#bowlG").remove();var r=e("<div/>").attr("id","formCont").append(e(t)).appendTo("body").hide();n.setFullName(e("#usernameDisabled, #usernameHidden",r)),e(".command_forcebuild",r).submit()})})},parseReasonString:function(){e(".codebases-list .reason-txt").each(function(){var t=e(this).text().trim();t==="A build was forced by '':"&&e(this).remove()})},selectBuildsAction:function(){e("#selectall").click(function(){e(".fi-js").prop("checked",this.checked)}),e("#submitBtn").click(function(){e("#formWrapper form").submit()}),e(".force-individual-js").click(function(t){t.preventDefault();var n=e(this).prev().prev().val(),r=e('<input checked="checked" name="cancelselected" type="hidden" value="'+n+'"  />');e(r).insertAfter(e(this)),e("#formWrapper form").submit()})},updateBuilders:function(){e.ajax({url:"/json?filter=0",dataType:"json",type:"GET",cache:!1,success:function(t){function s(t){var n=0;return e.each(t,function(){n+=parseFloat(this)||0}),n}var n=[],r=[],i=[];e.each(t.builders,function(e,t){n.push(e),r.push(t.pendingBuilds),t.state=="building"&&i.push(t.currentBuilds)});var o=[];e.each(t.slaves,function(e){o.push(e)});var u=[];e.each(t.project,function(e){u.push(e)}),e("#slavesNr").text(o.length),e("#pendingBuilds").text(s(r))}})},codeBaseBranchOverview:function(){var t=decodeURIComponent(window.location.search),n=t.split("&"),r=e('<div class="border-table-holder"><table class="codebase-branch-table"><tr class="codebase"><th>Codebase</th></tr><tr class="branch"><th>Branch</th></tr></table></div>');e(r).appendTo(e(".filter-table-input")),e(n).each(function(t){var n=this.split("=");if(n[0].indexOf("_branch")>0){var r=this.split("_branch")[0];t==0&&(r=this.replace("?","").split("_branch")[0]);var i=this.split("=")[1];e("tr.codebase").append("<td>"+r+"</td>"),e("tr.branch").append("<td>"+i+"</td>")}})},menuItemWidth:function(t){if(t){var n=0;e(".breadcrumbs-nav li").each(function(){n+=e(this).outerWidth()}),e(".breadcrumbs-nav").width(n+100)}else e(".breadcrumbs-nav").width("")},toolTip:function(t){e(t).parent().hover(function(){var n=e(t,this).attr("data-txt"),r=e("<div/>").addClass("tool-tip").text(n);e(this).append(e(r).css({top:e(t,this).position().top-10,left:e(t,this).position().left-20}).show())},function(){e(".tool-tip").remove()}),e(document).bind("click touchstart",function(t){e(".tool-tip").remove(),e(this).unbind(t)})},summaryArtifactTests:function(){var t=e("li.artifact-js").clone(),n=e("#showArtifactsJS");t.length>0?n.removeClass("no-artifacts").addClass("more-info mod-1 popup-btn-js-2").text("("+t.length+") Artifacts ").next().find(".builders-list").append(t):n.text("No Artifacts");var r=e(".s-logs-js").clone(),i=e("#testsListJS"),s=[];e(r).each(function(){var t=e(this).text().split(".").pop();(t==="xml"||t==="html")&&s.push(e(this))}),s.length>0&&(i.append(e("<li>Test Results</li>")),i.append(s))},setCookie:function(e,t,n){var r=new Date,i=new Date(r.getTime()+2592e6);if(n===undefined)var s=i.toGMTString();else var s="Thu, 01 Jan 1970 00:00:00 GMT;";var s=n===undefined?i.toGMTString():"Thu, 01 Jan 1970 00:00:00 GMT;";document.cookie=e+"="+escape(t)+"; path=/; expires="+s},startTimer:function(t,n){var n=n,r=e(t),i=function(e){var t=Math.floor(e/3600),n=Math.floor(e/60%60),i=Math.floor(e%60),s=[];t>0&&s.push(t==1?"1 hr":t+"hrs"),(n>0||t>0)&&s.push(n>1?n+" mins":n+" min"),(i>0||n>0||t>0)&&s.push(i>1?i+" secs":i+" sec"),r.html(s.join(" "))};i((new Date).getTime()/1e3-n)},getTime:function(e,t){t===null&&(t=Math.round(+(new Date)/1e3));var n=t-e,r=Math.round(n),i=Math.floor(n/3600)==0?"":Math.floor(n/3600)+" hours ",s=Math.floor(r/60)==0?"":Math.floor(r/60)+" mins, ",o=r-Math.floor(r/60)*60+" secs ";return i+s+o},getResult:function(e){var t=["success","warnings","failure","skipped","exception","retry","canceled"];return t[e]},getJsonUrl:function(){var e=document.URL,t=document.createElement("a");t.href=e,t.protocol,t.hostname,t.port,t.pathname,t.search,t.hash,t.host;var r=t.pathname.match(/\/builders\/([^\/]+)/),i=t.pathname.match(/\/builds\/([^\/]+)/);if(n.getCurrentPage()==="builders")var s=t.protocol+"//"+t.host+"/json/builders/";if(n.getCurrentPage()==="builddetail")var s=t.protocol+"//"+t.host+"/json/builders/"+r[1]+"/builds?select="+i[1]+"/";return s},getCurrentPage:function(t){var n=[e("#builddetail_page")],r=!1,i,s=e("#isFinished").attr("data-isfinished");return e.each(n,function(e,t){t.length===1&&!s&&(r=!0,n=t,i=n.selector.split("#")[1].split("_page")[0])}),t?r:i},getCookie:function(e){var t=new RegExp(e+"=([^;]+)"),n=t.exec(document.cookie);return n!=null?unescape(n[1]):""},eraseCookie:function(e,t,r){n.setCookie(e,t,r)},closePopup:function(t,n){e(document,".close-btn").bind("click touchstart",function(r){if(!e(r.target).closest(t).length||e(r.target).closest(".close-btn").length)n===undefined?t.remove():t.slideUp("fast",function(){e(this).remove()}),e(this).unbind(r)})}},n});