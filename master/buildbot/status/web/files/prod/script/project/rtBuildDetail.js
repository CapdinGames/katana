define(["jquery","realtimePages","helpers","popup","handlebars","mustache","text!templates/build.handlebars","text!templates/builders.mustache","timeElements","popup"],function(e,t,s,a,i,r,l,n,u,o){var c,d=Handlebars.compile(l),p=!1,f=!1;Handlebars.registerHelper("buildCSSClass",function(e){return s.getCssClassFromStatus(e)});var m={updateArtifacts:function(t){var s,a=e("#artifacts-js").empty(),i={},r={};e.each(t.steps,function(t,s){void 0!==s.urls&&e.each(s.urls,function(e,t){"string"==typeof t&&(i[e]=t)})}),e.each(t.logs,function(e,t){2===t.length&&(t[1].indexOf(".xml")>-1||t[1].indexOf(".html")>-1)&&(r[t[0]]=t[1])}),void 0===i||0===Object.keys(i).length?a.html("No artifacts"):(s='<a class="artifact-popup artifacts-js more-info" href="#">Artifacts ({0})&nbsp;</a>'.format(Object.keys(i).length),a.html(s),o.initArtifacts(i,a.find(".artifact-popup"))),Object.keys(r).length>0&&(s="<li>Test Results</li>",e.each(r,function(e,t){s+='<li class="s-logs-js"><a href="{0}">{1}</a></li>'.format(t,e)}),s=e("<ul/>").addClass("tests-summary-list").html(s),a.append(s))}};return c={init:function(){var a=t.defaultRealtimeFunctions();if(a.build=c.processBuildDetailPage,t.initRealtime(a),u.setHeartbeat(1e3),""!==window.location.search){var i=e(".top");s.codeBaseBranchOverview(i)}},processBuildDetailPage:function(t){var s=Object.keys(t);1===s.length&&(t=t[s[0]]);var a=t.times[0],i=t.times[1],r=null!==i,l=t.eta;c.refreshIfRequired(r),c.processBuildResult(t,a,l,r),c.processSteps(t),m.updateArtifacts(t),null===i&&u.addElapsedElem(e("#elapsedTimeJs"),a),u.updateTimeObjects()},processBuildResult:function(t,a,i,l){var o=e("#buildResult");u.clearTimeObjects(o);var c="";0!==i&&(c=r.render(n,{progressBar:!0,etaStart:a,etaCurrent:i}));var p={buildResults:!0,b:t,buildIsFinished:l,progressBar:c},f=d(p);o.html(f);var m=o.find(".percent-outer-js");m.addClass("build-detail-progress"),s.delegateToProgressBar(m)},processSteps:function(t){var a="",i=e("#stepList"),r=1;e.each(t.steps,function(e,t){if(t.hidden)return!0;var i=t.isStarted,l=t.isFinished,n=t.results[0];i?i&&!l&&(n=8):n=9;var u=s.getCssClassFromStatus(n),o=t.times[0],c=t.times[1],p=s.getTime(o,c),f={step:!0,index:r,stepStarted:t.isStarted,run_time:p,css_class:u,s:t,url:t.url};return a+=d(f),r+=1,!0}),i.html(a)},refreshIfRequired:function(e){!f&&p&&e&&(window.location=window.location+"#finished",window.location.reload()),f===!1&&(f=e),p=!0}}});
//# sourceMappingURL=rtBuildDetail.js.map