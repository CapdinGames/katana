define(["jquery","realtimePages","helpers","handlebars","mustache","text!templates/build.handlebars","text!templates/builders.mustache","timeElements","popup"],function(e,t,s,a,i,r,l,n,u){var o,c=Handlebars.compile(r),d=!1,p=!1;Handlebars.registerHelper("buildCSSClass",function(e){return s.getCssClassFromStatus(e)});var f={updateArtifacts:function(t){var s,a=e("#artifacts-js").empty(),i={},r={};e.each(t.steps,function(t,s){void 0!==s.urls&&e.each(s.urls,function(e,t){"string"==typeof t&&(i[e]=t)})}),e.each(t.logs,function(e,t){2===t.length&&(t[1].indexOf(".xml")>-1||t[1].indexOf(".html")>-1)&&(r[t[0]]=t[1])}),void 0===i||0===Object.keys(i).length?a.html("No artifacts"):(s='<a class="artifact-popup artifacts-js more-info" href="#">Artifacts ({0})&nbsp;</a>'.format(Object.keys(i).length),a.html(s),u.initArtifacts(i,a.find(".artifact-popup"))),Object.keys(r).length>0&&(s="<li>Test Results</li>",e.each(r,function(e,t){s+='<li class="s-logs-js"><a href="{0}">{1}</a></li>'.format(t,e)}),s=e("<ul/>").addClass("tests-summary-list").html(s),a.append(s))}};return o={init:function(){var a=t.defaultRealtimeFunctions();if(a.build=o.processBuildDetailPage,t.initRealtime(a),n.setHeartbeat(1e3),""!==window.location.search){var i=e(".top");s.codeBaseBranchOverview(i)}e(".popup-btn-js-2").click(function(t){t.preventDefault();var s=e(t.target),a=s.next(".more-info-box-js").html(),i=e("body"),r=e("<div/>").popup({title:"",html:a,destroyAfter:!0});i.append(r)})},processBuildDetailPage:function(t){var s=Object.keys(t);1===s.length&&(t=t[s[0]]);var a=t.times[0],i=t.times[1],r=null!==i,l=t.eta;o.refreshIfRequired(r),o.processBuildResult(t,a,l,r),o.processSteps(t),f.updateArtifacts(t),null===i&&n.addElapsedElem(e("#elapsedTimeJs"),a),n.updateTimeObjects()},processBuildResult:function(t,a,r,u){var o=e("#buildResult");n.clearTimeObjects(o);var d="";0!==r&&(d=i.render(l,{progressBar:!0,etaStart:a,etaCurrent:r}));var p={buildResults:!0,b:t,buildIsFinished:u,progressBar:d},f=c(p);o.html(f);var m=o.find(".percent-outer-js");m.addClass("build-detail-progress"),s.delegateToProgressBar(m)},processSteps:function(t){var a="",i=e("#stepList"),r=1;e.each(t.steps,function(e,t){if(t.hidden)return!0;var i=t.isStarted,l=t.isFinished,n=t.results[0];i?i&&!l&&(n=s.cssClassesEnum.RUNNING):n=s.cssClassesEnum.NOT_STARTED;var u=s.getCssClassFromStatus(n),o=t.times[0],d=t.times[1],p=s.getTime(o,d),f={step:!0,index:r,stepStarted:t.isStarted,run_time:p,css_class:u,s:t,url:t.url};return a+=c(f),r+=1,!0}),i.html(a)},refreshIfRequired:function(e){!p&&d&&e&&(window.location=window.location+"#finished",window.location.reload()),p===!1&&(p=e),d=!0}}});
//# sourceMappingURL=rtBuildDetail.js.map