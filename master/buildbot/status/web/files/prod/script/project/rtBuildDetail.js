define(["jquery","realtimePages","helpers","popup","handlebars","mustache","text!templates/build.handlebars","text!templates/builders.mustache"],function(e,t,n,r,i,s,o,u){var a,f=e("#stepList").find("> li"),l=Handlebars.compile(o),c=!1,h=!1,p=!1;return Handlebars.registerHelper("buildCSSClass",function(e){return n.getCssClassFromStatus(e)}),a={init:function(){var e=t.defaultRealtimeFunctions();e.build=a.processBuildDetailPage,t.initRealtime(e)},processBuildDetailPage:function(t){var r=Object.keys(t);r.length==1&&(t=t[r[0]]);var i=t.times[0],s=t.times[1],o=s!==null,u=t.eta;a.refreshIfRequired(o),a.processBuildResult(t,i,u,o),a.processSteps(t),n.summaryArtifactTests(),s===null&&h==0&&(n.startCounter(e("#elapsedTimeJs"),i),h=!0)},processBuildResult:function(t,r,i,o){var a=e("#buildResult"),f="";i!=0&&(f=s.render(u,{progressBar:!0,etaStart:r,etaCurrent:i}));var c={buildResults:!0,b:t,buildIsFinished:o,progressBar:f},h=l(c);a.html(h);var p=a.find(".percent-outer-js");p.addClass("build-detail-progress"),n.delegateToProgressBar(p)},processSteps:function(t){var r="",i=e("#stepList"),s=1;e.each(t.steps,function(e,t){if(t.hidden)return!0;var i=t.isStarted,o=t.isFinished,u=t.results[0];i?i&&!o&&(u=7):u=8;var a=n.getCssClassFromStatus(u),f=t.times[0],c=t.times[1],h=n.getTime(f,c),p={step:!0,index:s,stepStarted:t.isStarted,run_time:h,css_class:a,s:t,url:t.url};r+=l(p),s++}),i.html(r)},refreshIfRequired:function(e){!p&&c&&e&&(window.location=window.location+"#finished",window.location.reload()),p==0&&(p=e),c=!0}},a});