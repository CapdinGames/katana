define(["jquery","helpers","popup","text!templates/builders.html","mustache"],function(e,t,n,r,i){var s,o=e("#tablesorterRt").dataTable(),u=e("#stepList > li"),a=e(".current-step-js");return s={initRealtime:function(n){function o(e){s&&s.send(e)}function u(){var t=e("#instant-json");return t.length?(t.remove(),instantJSON):undefined}function a(e){typeof e=="string"&&(e=JSON.parse(e)),n(e),console.log("Reloading data...")}var r=u();r!==undefined&&(console.log("Loaded from instant JSON"),a(r)),window.sock=null;var i=e("body").attr("data-realTimeServer"),s;console.log(i),"WebSocket"in window?s=new WebSocket(i):"MozWebSocket"in window?s=new MozWebSocket(i):(log("Browser does not support WebSocket!"),window.location="http://autobahn.ws/unsupportedbrowser"),s&&(s.onopen=function(){e("#bowlG").remove(),o(t.getJsonUrl())},s.onclose=function(e){s=null},s.onmessage=function(e){a(e.data)})},rtBuildDetail:function(n,r){try{e.each(n,function(n,r){var i=r.times[0],s=r.times[1],o=r.text;t.startCounter(e("#elapsedTimeJs"),i),s&&(window.location.hash||(window.location=window.location+"#finished",window.location.reload()),sock.close());var f=0;e.each(r.steps,function(n,r){var i=r.isStarted,s=r.isFinished===!0,o=i&&!s,l=r.times[0],c=r.times[1],h=t.getResult(r.results[0]),p=r.hidden===!0;if(p!=1){f=++f;if(o){var d=r.logs.length>0,v=r.urls.length>0;if(d){var m="";u.children(".logs-txt").eq(f-1).text("Logs"),e.each(r.logs,function(e,t){var n=t[0],r=t[1];m+='<li class="s-logs-js"><a href='+r+">"+n+"</a></li>"}),u.children(".log-list-js").eq(f-1).html(m)}if(v){var g="";e.each(r.urls,function(e,n){g+='<li class="urls-mod log-list-'+t.getResult(n.results)+'"><a href="'+n.url+'">'+e+"</a></li>"}),u.children(".log-list-js").eq(f-1).append(g)}u.children(".update-time-js").eq(f-1).html("Running"),u.children(".s-text-js").eq(f-1).html(r.text.join(" ")),u.children(".s-result-js").eq(f-1).removeClass().addClass("running result s-result-js"),u.eq(f-1).removeClass().addClass("status-running"),a.text(r.name)}else s&&(u.children(".update-time-js").eq(f-1).html(t.getTime(l,c)),u.children(".s-result-js").eq(f-1).removeClass().addClass(h+" result s-result-js"),u.eq(f-1).removeClass().addClass("finished status-"+h))}})})}catch(i){}},buildersPage:function(e){o.fnClearTable();try{o.fnAddData(e.builders)}catch(t){}},rtBuildSlaves:function(t){o.fnClearTable();try{e.each(t,function(e,t){var n=[t];o.fnAddData(n)})}catch(n){}},rtBuildqueue:function(e){o.fnClearTable();try{o.fnAddData(e)}catch(t){}}},s});