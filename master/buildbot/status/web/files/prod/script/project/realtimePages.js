define(["jquery","helpers","popup","text!templates/builders.html","text!templates/buildqueue.html","mustache","livestamp"],function(e,t,n,r,i,s){var o;return o={buildDetail:function(n,r){var i=e(".current-step-js");try{var s=JSON.parse(n);e.each(s,function(n,s){var o=s.times[0],u=s.times[1],a=s.text,f=setInterval(function(){t.startTimer(e("#elapsedTimeJs"),o)},1e3);u&&(clearInterval(f),window.location.hash||(window.location=window.location+"#finished",window.location.reload()),sock.close());var l=0;e.each(s.steps,function(n,s){var o=s.isStarted,u=s.isFinished===!0,a=o&&!u,f=s.times[0],c=s.times[1],h=t.getResult(s.results[0]),p=s.hidden===!0;if(p!=1){l=++l;if(a){var d=s.logs.length>0,v=s.urls.length>0;if(d){var m="";r.children(".logs-txt").eq(l-1).text("Logs"),e.each(s.logs,function(e,t){var n=t[0],r=t[1];m+='<li class="s-logs-js"><a href='+r+">"+n+"</a></li>"}),r.children(".log-list-js").eq(l-1).html(m)}if(v){var g="";e.each(s.urls,function(e,n){g+='<li class="urls-mod log-list-'+t.getResult(n.results)+'"><a href="'+n.url+'">'+e+"</a></li>"}),r.children(".log-list-js").eq(l-1).append(g)}r.children(".update-time-js").eq(l-1).html("Running"),r.children(".s-text-js").eq(l-1).html(s.text.join(" ")),r.children(".s-result-js").eq(l-1).removeClass().addClass("running result s-result-js"),r.eq(l-1).removeClass().addClass("status-running"),i.text(s.name)}else u&&(r.children(".update-time-js").eq(l-1).html(t.getTime(f,c)),r.children(".s-result-js").eq(l-1).removeClass().addClass(h+" result s-result-js"),r.eq(l-1).removeClass().addClass("finished status-"+h))}})})}catch(o){}},buildersPage:function(i,o){try{var u=JSON.parse(i),a=0,f=u.builders;e.each(f,function(i,o){var u=e('[id="'+o.name+'"]'),f=u.find(".current-cont"),l=u.find(".pending-cont"),c=u.find(".jobs-js"),h=u.find(".last-build-js"),p=u.find(".status-build-js");if(o.pendingBuilds>0){a=++a;var d=e(s.render(r,{popupbtn:"true",number:a-1}));l.html(d).children(d).click(function(e){e.preventDefault(),n.pendingJobs(d)})}else l.html("");if(o.currentBuilds.length>0){var v="",m=e('<h2 class="small-head">Current job</h2>');v='<h2 class="small-head">Current job</h2><ul class="list current-job-js">';var g="",y="";e.each(o.currentBuilds,function(t,n){e.each(n.currentStep,function(e,t){e==="name"&&(g=t)}),v+=s.render(r,{li:{name:g,number:n.number,url:n.url}})}),v+="</ul>",f.html(v)}o.pendingBuilds===0&&o.currentBuilds.length===0&&f.html('<span class="small-txt"> No jobs </span>'),o.latestBuild&&e.each(o.latestBuild,function(e,n){var r=p.find(".build-url-js");if(e==="times"){var i=t.getTime(n[0],n[1]).trim();h.find(".last-run").attr("data-livestamp",n[1]),h.find(".small-txt").html("("+i+")"),h.find(".hidden-date-js").html(n[1])}e==="text"&&p.find(".hide-status-js, .status-text-js").text(n[0]),e==="number"&&r.text("#"+n),e==="url"&&r.attr("href",n)})})}catch(l){}},rtBuildSlaves:function(n){try{var r=JSON.parse(n),i=0;e.each(r,function(n,r){var i=e('[id="'+r.friendly_name+'"]'),s=i.find(".status-td");s.html(t.getSlavesResult(r.connected,r.runningBuilds)),s.removeClass().addClass(t.getClassName(r.connected,r.runningBuilds))})}catch(s){}},rtBuildqueue:function(t){var n=e(".tablesorter-js").dataTable();n.fnClearTable();try{var r=JSON.parse(t),i=r[0],s={};e.each(r,function(e,t){var r=[t];n.fnAddData(r)})}catch(o){}}},o});