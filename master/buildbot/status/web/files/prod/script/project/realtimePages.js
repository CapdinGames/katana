define(["jquery","helpers","popup","text!templates/builders.html","mustache"],function(e,t,n,r,i){var s;return s={initRealtime:function(n){function o(e){s&&s.send(e)}function u(){var t=e("#instant-json");return t.length?(t.remove(),instantJSON):undefined}function a(e){typeof e=="string"&&(e=JSON.parse(e)),n(e),console.log("Reloading data...")}var r=u();r!==undefined&&(console.log("Loaded from instant JSON"),a(r)),window.sock=null;var i=e("body").attr("data-realTimeServer"),s;console.log(i),"WebSocket"in window?s=new WebSocket(i):"MozWebSocket"in window?s=new MozWebSocket(i):(log("Browser does not support WebSocket!"),window.location="http://autobahn.ws/unsupportedbrowser"),s&&(s.onopen=function(){e("#bowlG").remove(),o(t.getJsonUrl())},s.onclose=function(e){s=null},s.onmessage=function(e){a(e.data)})},rtBuildDetail:function(n){var r=e("#stepList > li"),i=e(".current-step-js");try{e.each(n,function(n,s){var o=s.times[0],u=s.times[1],a=s.text;t.startCounter(e("#elapsedTimeJs"),o),u&&(window.location.hash||(window.location=window.location+"#finished",window.location.reload()),sock.close());var f=0;e.each(s.steps,function(n,s){var o=s.isStarted,u=s.isFinished===!0,a=o&&!u,l=s.times[0],c=s.times[1],h=t.getResult(s.results[0]),p=s.hidden===!0;if(p!=1){f=++f;if(a){var d=s.logs.length>0,v=s.urls.length>0;if(d){var m="";r.children(".logs-txt").eq(f-1).text("Logs"),e.each(s.logs,function(e,t){var n=t[0],r=t[1];m+='<li class="s-logs-js"><a href='+r+">"+n+"</a></li>"}),r.children(".log-list-js").eq(f-1).html(m)}if(v){var g="";e.each(s.urls,function(e,n){g+='<li class="urls-mod log-list-'+t.getResult(n.results)+'"><a href="'+n.url+'">'+e+"</a></li>"}),r.children(".log-list-js").eq(f-1).append(g)}r.children(".update-time-js").eq(f-1).html("Running"),r.children(".s-text-js").eq(f-1).html(s.text.join(" ")),r.children(".s-result-js").eq(f-1).removeClass().addClass("running result s-result-js"),r.eq(f-1).removeClass().addClass("status-running"),i.text(s.name)}else u&&(r.children(".update-time-js").eq(f-1).html(t.getTime(l,c)),r.children(".s-result-js").eq(f-1).removeClass().addClass(h+" result s-result-js"),r.eq(f-1).removeClass().addClass("finished status-"+h))}})})}catch(s){}},buildersPage:function(t){var n=e("#tablesorterRt").dataTable();n.fnClearTable();try{n.fnAddData(t.builders)}catch(r){}},rtBuildSlaves:function(t){var n=e("#tablesorterRt").dataTable();n.fnClearTable();try{e.each(t,function(e,t){var r=[t];n.fnAddData(r)})}catch(r){}},rtBuildqueue:function(t){var n=e("#tablesorterRt").dataTable();n.fnClearTable();try{n.fnAddData(t)}catch(r){}}},s});