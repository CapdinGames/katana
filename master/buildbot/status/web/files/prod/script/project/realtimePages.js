define(["jquery","rtglobal","helpers","timeElements"],function(e,t){var n=null,o={},a={},r={},i="krtJSONData",l="krtURLDropped",s="krtRegisterURL",c=3e4,d=3e4,u=5e3,m={createWebSocket:function(t){return null==n&&("WebSocket"in window?n=new WebSocket(t):"MozWebSocket"in window?n=new MozWebSocket(t):(log("Browser does not support WebSocket!"),window.location="http://autobahn.ws/unsupportedbrowser"),n&&(n.onopen=function(){e("#bowlG").remove(),e.each(a,function(e,t){m.sendCommand(s,t)})},n.onclose=function(){n=null,console.log("We lost our connection, retrying in {0} seconds...".format(d/1e3)),setTimeout(function(){m.createWebSocket(t)},d)},n.onmessage=function(e){var t=e.data;"string"==typeof t&&(t=JSON.parse(t)),m.parseRealtimeCommand(t)})),n},initRealtime:function(t){o=t;var n=m.getInstantJSON();void 0!==n&&(console.log("Loaded from instant JSON"),m.updateRealTimeData(n,!0));var a=e("body").attr("data-realTimeServer");void 0!==a&&""!=a?(console.log(a),m.createWebSocket(a)):console.log("Realtime server not found, disabling realtime.")},sendCommand:function(e,t){if(n){var o=JSON.stringify({cmd:e,data:t});n.send(o)}},parseRealtimeCommand:function(e){e.cmd===i&&m.updateRealTimeData(e.data,!1),e.cmd===l&&(console.log("URL Dropped by server will retry in {0} seconds... ({1})".format(c/1e3,e.data)),setTimeout(function(){m.sendCommand(s,e.data)},c))},updateRealTimeData:function(t,n){if(n===!0)e.each(t,function(e,t){var n=t.data;"string"==typeof n&&(n=JSON.parse(n),a[e]=t.url),m.updateSingleRealTimeData(e,n)});else{var o=m.getRealtimeNameFromURL(t.url);m.updateSingleRealTimeData(o,t.data)}},getRealtimeNameFromURL:function(t){var n=void 0;return e.each(a,function(e,o){return o===t?(n=e,!1):!0}),n},updateSingleRealTimeData:function(e,t,n){var a=!0,i=new Date;void 0!==n&&n||!r.hasOwnProperty(e)||i-r[e]<u&&(a=!1),a&&o.hasOwnProperty(e)&&(o[e](t),r[e]=i,console.log("Reloading data for {0}...".format(e)))},getInstantJSON:function(){var t=e("#instant-json");return e("#bowlG").remove(),e(".initjson").show(),t.length?(t.remove(),instantJSON):void 0},defaultRealtimeFunctions:function(){return{global:t.processGlobalInfo}}};return m});
//# sourceMappingURL=realtimePages.js.map