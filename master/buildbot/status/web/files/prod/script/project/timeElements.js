define(["jquery","moment","extend-moment"],function(e,t,n){var a,r,i=5e3,o=80,s={timeAgo:[],elapsed:[],progressBars:[]},c=t.lang(),m=0,l={heartbeatInterval:function(){clearTimeout(r),r=setTimeout(l.heartbeat,i)},heartbeat:function(t){var n=new Date;(t===!0||n-a>i)&&(e.each(s.timeAgo,function(e,t){l.processTimeAgo(t.el,t.time)}),e.each(s.elapsed,function(e,t){l.processElapsed(t.el,t.time)}),e.each(s.progressBars,function(e,t){if(void 0!==a&&0!==t.eta){var r=n-a;t.eta-=r/1e3}l.processProgressBars(t.el,t.time,t.eta)}),a=n),void 0!==r&&l.heartbeatInterval()},addElem:function(t,n,a){t.length&&void 0===e(t).attr("data-timeElem")&&(e(t).attr("data-timeElem","true"),a.push(n))},spinIconAnimation:function(){var t=10,n=13;e.each(e(".animate-spin"),function(a,r){var i=e(r);m>=t&&(m=0);var o=m*-n;i.css("background-position",o+"px 0px")}),m+=1},processTimeAgo:function(e,n){e.html(t.unix(n).fromServerNow())},processElapsed:function(e,a){var r=n.getServerTime().unix(),i=r-a;t.lang("waiting-en"),e.html(t.duration(i,"seconds").humanize(!0)),t.lang(c)},processProgressBars:function(e,a,r){var i=n.getServerOffset(),o=t.unix(a),s=e.children(".percent-inner-js"),m=e.children(".time-txt-js"),l=0!==r,d=100;if(l){var u=t()+i,f=u+1e3*r,p=0>r,v=t().add("s",r)+i;d=100-(v-u)/(v-o)*100,d=d.clamp(0,100),t.lang("progress-bar-en"),m.html(t(f).fromServerNow()),p&&e.addClass("overtime")}else t.lang("progress-bar-no-eta-en"),m.html(t(parseInt(1e3*a,10)).fromServerNow());t.lang(c),s.css("width",d+"%")}};return{init:function(){void 0===r&&l.heartbeatInterval(),setInterval(l.spinIconAnimation,o)},addTimeAgoElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};l.addElem(a,r,s.timeAgo)},addElapsedElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};l.addElem(a,r,s.elapsed)},addProgressBarElem:function(t,n,a){var r=e(t),i={el:r,time:parseInt(n,10),eta:parseInt(a,10)};l.addElem(r,i,s.progressBars)},updateTimeObjects:function(){l.heartbeat(!0)},clearTimeObjects:function(t){if(void 0!==t){var n=e(t).find("[data-timeElem]");e.each(s,function(t,a){s[t]=e.grep(a,function(t){var a=!1;return e.contains(document.documentElement,t.el[0])?(e.each(n,function(n,r){return e(r).is(t.el)?(a=!0,!1):!0}),a):!0},!0)})}else e.each(s,function(e){s[e]=[]})},setHeartbeat:function(e){i=e,l.heartbeatInterval()}}});
//# sourceMappingURL=timeElements.js.map