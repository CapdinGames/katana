define(["jquery","moment","extend-moment"],function(e,t,n){var a,r,i=5e3,o=80,s={timeAgo:[],elapsed:[],progressBars:[]},c=t.lang(),d=0,m={heartbeatInterval:function(){clearTimeout(r),r=setTimeout(m.heartbeat,i)},heartbeat:function(t){var n=new Date;(t===!0||n-a>i)&&(e.each(s.timeAgo,function(e,t){m.processTimeAgo(t.el,t.time)}),e.each(s.elapsed,function(e,t){m.processElapsed(t.el,t.time)}),e.each(s.progressBars,function(e,t){if(void 0!==a&&0!==t.eta){var r=n-a;t.eta-=r/1e3}m.processProgressBars(t.el,t.time,t.eta)}),a=n),m.heartbeatInterval()},addElem:function(t,n,a){t.length&&void 0===e(t).attr("data-timeElem")&&(e(t).attr("data-timeElem","true"),a.push(n))},spinIconAnimation:function(){var t=10,n=13;e.each(e(".animate-spin"),function(a,r){var i=e(r);d>=t&&(d=0);var o=d*-n;i.css("background-position",o+"px 0px")}),d+=1},processTimeAgo:function(e,n){e.html(t.unix(n).fromServerNow())},processElapsed:function(e,a){var r=n.getServerTime().unix(),i=r-a;t.lang("waiting-en"),e.html(t.duration(i,"seconds").humanize(!0)),t.lang(c)},processProgressBars:function(e,a,r){var i=n.getServerOffset(),o=t.unix(a).startOf("second"),s=o.unix().toFixed(2),d=e.children(".percent-inner-js"),m=e.children(".time-txt-js"),l=0!==r,u=100;if(l){var f=t().add("ms",i).startOf("second").unix().toFixed(2),p=t().add("s",r).add("ms",i).startOf("second"),v=p.unix().toFixed(2),g=t(p).diff()<0;u=Math.floor(100-(v-f)/(v-s)*100),u=u.clamp(0,100),t.lang("progress-bar-en"),m.html(t(p).fromServerNow()),g&&e.addClass("overtime")}else t.lang("progress-bar-no-eta-en"),m.html(o.fromServerNow());t.lang(c),d.css("width",u+"%")}};return{init:function(){void 0===r&&(m.heartbeatInterval(),n.init()),setInterval(m.spinIconAnimation,o)},addTimeAgoElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};m.addElem(a,r,s.timeAgo)},addElapsedElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};m.addElem(a,r,s.elapsed)},addProgressBarElem:function(t,n,a){var r=e(t),i={el:r,time:parseInt(n,10),eta:parseInt(a,10)};m.addElem(r,i,s.progressBars)},updateTimeObjects:function(){m.heartbeat(!0)},clearTimeObjects:function(t){if(void 0!==t){var n=e(t).find("[data-timeelem]");e.each(s,function(t,a){s[t]=e.grep(a,function(t){var a=!1;return e.contains(document.documentElement,t.el[0])?(e.each(n,function(n,r){return e(r).is(t.el)?(a=!0,!1):!0}),a):!0},!0)})}else e.each(s,function(e){s[e]=[]})},setHeartbeat:function(e){i=e,m.heartbeatInterval()},_timeObjects:s}});
//# sourceMappingURL=timeElements.js.map