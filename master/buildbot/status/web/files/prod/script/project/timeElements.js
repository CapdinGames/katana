define(["jquery","moment","extend-moment"],function(e,t,n){var a,r,i=5e3,o=80,s={timeAgo:[],elapsed:[],progressBars:[]},c=t.lang(),m=0,d={heartbeatInterval:function(){clearTimeout(r),r=setTimeout(d.heartbeat,i)},heartbeat:function(t){var n=new Date;(t===!0||n-a>i)&&(e.each(s.timeAgo,function(e,t){d.processTimeAgo(t.el,t.time)}),e.each(s.elapsed,function(e,t){d.processElapsed(t.el,t.time)}),e.each(s.progressBars,function(e,t){if(void 0!==a&&0!==t.eta){var r=n-a;t.eta-=r/1e3}d.processProgressBars(t.el,t.time,t.eta)}),a=n),d.heartbeatInterval()},addElem:function(t,n,a){t.length&&void 0===e(t).attr("data-timeElem")&&(e(t).attr("data-timeElem","true"),a.push(n))},spinIconAnimation:function(){var t=10,n=13;e.each(e(".animate-spin"),function(a,r){var i=e(r);m>=t&&(m=0);var o=m*-n;i.css("background-position",o+"px 0px")}),m+=1},processTimeAgo:function(e,n){e.html(t.unix(n).fromServerNow())},processElapsed:function(e,a){var r=n.getServerTime().unix(),i=r-a;t.lang("waiting-en"),e.html(t.duration(i,"seconds").humanize(!0)),t.lang(c)},processProgressBars:function(e,a,r){var i=n.getServerOffset(),o=t.unix(a).startOf("second"),s=(1e3*o.unix()).toFixed(2),m=e.children(".percent-inner-js"),d=e.children(".time-txt-js"),l=0!==r,u=100;if(l){var f=(t().startOf("second")+i).toFixed(2),p=o+1e3*r,v=0>r,g=(t().startOf("second").add("s",r)+i).toFixed(2);u=Math.round(100-(g-f)/(g-s)*100),u=u.clamp(0,100),t.lang("progress-bar-en"),d.html(t(p).fromServerNow()),v&&e.addClass("overtime")}else t.lang("progress-bar-no-eta-en"),d.html(t(1e3*parseFloat(a)).fromServerNow());t.lang(c),m.css("width",u+"%")}};return{init:function(){void 0===r&&(d.heartbeatInterval(),n.init()),setInterval(d.spinIconAnimation,o)},addTimeAgoElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};d.addElem(a,r,s.timeAgo)},addElapsedElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};d.addElem(a,r,s.elapsed)},addProgressBarElem:function(t,n,a){var r=e(t),i={el:r,time:parseInt(n,10),eta:parseInt(a,10)};d.addElem(r,i,s.progressBars)},updateTimeObjects:function(){d.heartbeat(!0)},clearTimeObjects:function(t){if(void 0!==t){var n=e(t).find("[data-timeelem]");e.each(s,function(t,a){s[t]=e.grep(a,function(t){var a=!1;return e.contains(document.documentElement,t.el[0])?(e.each(n,function(n,r){return e(r).is(t.el)?(a=!0,!1):!0}),a):!0},!0)})}else e.each(s,function(e){s[e]=[]})},setHeartbeat:function(e){i=e,d.heartbeatInterval()},_timeObjects:s}});
//# sourceMappingURL=timeElements.js.map