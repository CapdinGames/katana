define(["datatables-plugin","helpers","libs/natural-sort","popup","text!templates/buildqueue.mustache","text!templates/buildslaves.mustache","text!templates/builders.mustache","mustache","moment"],function(e,t,n,r,i,s,o,u,a){var f;return f={init:function(e){f.initSortNatural(),e.each(function(e,n){var r=$(n),f=[],l={bPaginate:!1,bLengthChange:!1,bFilter:!1,bSort:!0,bInfo:!1,bAutoWidth:!1,sDom:'<"table-wrapper"t>',bRetrieve:!0,asSorting:!0,bServerSide:!1,bSearchable:!0,aaSorting:[],iDisplayLength:50,bStateSave:!0};$(this).hasClass("input-js")&&(l.bFilter=!0,l.oLanguage={sSearch:""},l.sDom='<"top"flip><"table-wrapper"t><"bottom"pi>');var c=undefined,h=[],p=r.attr("data-default-sort-dir")||"asc";n.hasAttribute("data-default-sort-col")&&(c=parseInt(r.attr("data-default-sort-col")),l.aaSorting=[[c,p]]),$("> thead th",this).each(function(e,t){$(t).hasClass("no-tablesorter-js")?h.push({bSortable:!1}):c!==undefined&&c===e?h.push({sType:"natural"}):h.push(null)}),l.aoColumns=h,$(this).hasClass("buildqueue-table")?(l.aaSorting=[[2,"asc"]],l.aoColumns=[{mData:"builderFriendlyName"},{mData:"sources"},{mData:"reason"},{mData:"slaves"},{mData:"brid",bSortable:!1}],l.aoColumnDefs=[{sClass:"txt-align-left",aTargets:[0]},{aTargets:[1],sClass:"txt-align-left",mRender:function(e,t,n){var r=n.sources.length,s=u.render(i,{showsources:!0,sources:n.sources,codebase:n.codebase,sourcesLength:r});return s},fnCreatedCell:function(e,t,n,r,i){$(e).find("a.popup-btn-json-js").data({showCodebases:n})}},{aTargets:[2],sClass:"txt-align-left",mRender:function(e,n,r){var s=a.unix(r.submittedAt).format("MMMM Do YYYY, H:mm:ss"),o=t.getTime(r.submittedAt,null),f=u.render(i,{reason:r.reason,requested:s,submittedAt:r.submittedAt});return f},fnCreatedCell:function(e,n,r,i,s){t.startCounter($(e).find(".waiting-time"),r.submittedAt)}},{aTargets:[3],sClass:"txt-align-right",mRender:function(e,t,n){var r=n.slaves.length,s=u.render(i,{showslaves:!0,slaves:e,slavelength:r});return s},fnCreatedCell:function(e,t,n,r,i){$(e).find("a.popup-btn-json-js").data({showcompatibleSlaves:n})}},{aTargets:[4],sClass:"select-input",mRender:function(e,t,n){var r=u.render(i,{input:"true",brid:n.brid});return r}}]):$(this).hasClass("builders-table")?(l.aoColumns=[{mData:null},{mData:null},{mData:null},{mData:null},{mData:null,bSortable:!1}],l.aoColumnDefs=[{aTargets:[0],sClass:"txt-align-left",mRender:function(e,n,r){var i=t.codebasesFromURL({}),s=[];for(var a in i)s.push(encodeURIComponent(a)+"="+encodeURIComponent(i[a]));var f=s.join("&"),l=u.render(o,{name:r.name,friendly_name:r.friendly_name,builderParam:f});return l}},{aTargets:[1],sClass:"txt-align-left",mRender:function(e,t,n){var r=!1;(n.pendingBuilds===undefined||n.pendingBuilds==0)&&(n.currentBuilds===undefined||n.currentBuilds==0)&&(r=!0);var i=u.render(o,{showNoJobs:r,pendingBuilds:n.pendingBuilds,currentBuilds:n.currentBuilds,builderName:n.name,projects:n.project});return i},fnCreatedCell:function(e,n,r,i,s){r.currentBuilds!=undefined&&t.delegateToProgressBar($(e).find(".percent-outer-js"))}},{aTargets:[2],sClass:"txt-align-left last-build-js",mRender:function(e,t,n){var r=u.render(o,{showLatestBuild:!0,latestBuild:n.latestBuild});return r},fnCreatedCell:function(e,n,r,i,s){if(r.latestBuild!=undefined){t.startCounterTimeago($(e).find(".last-run"),r.latestBuild.times[1]);var o=t.getTime(r.latestBuild.times[0],r.latestBuild.times[1]).trim();$(e).find(".small-txt").html("("+o+")"),$(e).find(".hidden-date-js").html(r.latestBuild.times[1])}}},{aTargets:[3],mRender:function(e,t,n){var r=n.latestBuild,i=u.render(o,{showStatus:!0,latestBuild:n.latestBuild});return i},fnCreatedCell:function(e,t,n,r,i){var s=n.latestBuild===undefined?"":n.latestBuild;$(e).removeClass().addClass(s.results_text)}},{aTargets:[4],mRender:function(e,t,n){var r=location.protocol+"//"+location.host,i=u.render(o,{customBuild:!0,builderUrlShow:r,project:n.project,builderName:n.name});return i}}]):$(this).hasClass("buildslaves-table")&&(l.aoColumns=[{mData:null},{mData:null},{mData:null},{mData:null},{mData:null}],l.aoColumnDefs=[{aTargets:[0],sClass:"txt-align-left",mRender:function(e,t,n){var r=u.render(s,{showFriendlyName:!0,friendly_name:n.friendly_name,host_name:n.name});return r}},{aTargets:[1],sClass:"txt-align-left",mRender:function(e,t,n){var r=u.render(s,{buildersPopup:!0});return r},fnCreatedCell:function(e,t,n,r,i){$(e).find("a.popup-btn-json-js").data({showBuilders:n})}},{aTargets:[2],sClass:"txt-align-left",mRender:function(e,t,n){var r=n.name!=undefined?n.name:"Not Available";return r}},{aTargets:[3],mRender:function(e,t,n){var r,i=0;if(n.connected===undefined||n.connected===!1)r="Offline";else if(n.connected===!0&&n.runningBuilds===undefined)r="Idle";else if(n.connected===!0&&n.runningBuilds.length>0){r=n.runningBuilds.length+" build(s) ";var o=!0}n.runningBuilds!=undefined&&($.each(n.runningBuilds,function(e,t){t.eta!=undefined&&t.eta<0&&i++}),i=i>0?i:!1);var a=u.render(s,{showStatusTxt:r,showSpinIcon:o,showOvertime:i});return a},fnCreatedCell:function(e,t,n,r,i){n.connected===undefined?$(e).addClass("offline"):n.connected===!0&&n.runningBuilds===undefined?$(e).addClass("idle"):n.connected===!0&&n.runningBuilds.length>0&&$(e).addClass("building").find("a.popup-btn-json-js").data({showRunningBuilds:n})}},{aTargets:[4],mRender:function(e,t,n){var r=n.lastMessage!=undefined?!0:null,i=r?" ("+a.unix(n.lastMessage).format("MMM Do YYYY, H:mm:ss")+")":"",o=u.render(s,{showTimeago:r,showLastMessageDate:i});return o},fnCreatedCell:function(e,n,r,i,s){t.startCounterTimeago($(e).find(".last-message-timemago"),r.lastMessage)}}]),$(this).hasClass("tools-js")&&(l.bPaginate=!0,l.bLengthChange=!0,l.bInfo=!0,l.bFilter=!0,l.oLanguage={sSearch:"",sLengthMenu:'Entries per page<select><option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="100">100</option><option value="-1">All</option></select>'},l.sDom='<"top"flip><"table-wrapper"t><"bottom"pi>');var d=$(this).dataTable(l),v=$(".dataTables_wrapper .top");$("#builders_page").length&&window.location.search!=""&&t.codeBaseBranchOverview(v),$(this).hasClass("branches-selectors-js")&&$(".dataTables_wrapper .top").append('<div class="filter-table-input"><input value="Show builders" class="blue-btn var-2" type="submit" /><h4 class="help-txt">Select branch for each codebase before showing builders</h4></div>'),$(this).parents(".dataTables_wrapper").find(".dataTables_filter input").attr("placeholder","Filter results").focus()})},initSortNatural:function(){jQuery.extend(jQuery.fn.dataTableExt.oSort,{"natural-pre":function(e){return $(e).text().trim()},"natural-asc":function(e,t){return n.sort(e,t)},"natural-desc":function(e,t){return n.sort(e,t)*-1}})}},f});