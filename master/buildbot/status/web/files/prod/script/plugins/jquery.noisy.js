(function(e){e.fn.noisy=function(t){function m(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}t=e.extend({},e.fn.noisy.defaults,t),typeof t.color!="undefined"&&(t.randomColors=!1);var n,r,i=!1;try{r=!0,localStorage.setItem("test",""),localStorage.removeItem("test"),i=localStorage.getItem(window.JSON.stringify(t))}catch(s){r=!1}if(i&&!t.disableCache)n=i;else{var o=document.createElement("canvas");if(!o.getContext)n=t.fallback;else{o.width=o.height=t.size;var u=o.getContext("2d"),a=u.createImageData(o.width,o.height),f=Math.round(t.intensity*Math.pow(t.size,2)),l=255*t.opacity;while(f--){var c=~~(Math.random()*o.width),h=~~(Math.random()*o.height),p=(c+h*a.width)*4;if(t.randomColors){var d=f%255;t.colorChannels===parseInt(t.colorChannels)?d=f%t.colorChannels:e.isArray(t.colorChannels)&&(d=t.colorChannels[0]+f%(t.colorChannels[1]-t.colorChannels[0])),a.data[p]=d,a.data[p+1]=t.monochrome?d:~~(Math.random()*255),a.data[p+2]=t.monochrome?d:~~(Math.random()*255),a.data[p+3]=~~(Math.random()*l)}else{var v=m(t.color);a.data[p]=v.r,a.data[p+1]=v.g,a.data[p+2]=v.b,a.data[p+3]=~~(Math.random()*l)}}u.putImageData(a,0,0),n=o.toDataURL("image/png"),n.indexOf("data:image/png")!=0&&(n=t.fallback)}if(window.JSON&&r&&!t.disableCache)try{localStorage.setItem(window.JSON.stringify(t),n)}catch(s){console.warn(s.message)}}return this.each(function(){e(this).css("background-image","url('"+n+"'),"+e(this).css("background-image"))})},e.fn.noisy.defaults={intensity:.9,size:200,opacity:.08,fallback:"",monochrome:!1,colorChannels:255,randomColors:!0,disableCache:!1}})(jQuery);