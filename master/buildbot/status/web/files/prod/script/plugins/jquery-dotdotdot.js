/*	
 *	jQuery dotdotdot 1.6.5
 *	
 *	Copyright (c) 2013 Fred Heusschen
 *	www.frebsite.nl
 *
 *	Plugin website:
 *	dotdotdot.frebsite.nl
 *
 *	Dual licensed under the MIT and GPL licenses.
 *	http://en.wikipedia.org/wiki/MIT_License
 *	http://en.wikipedia.org/wiki/GNU_General_Public_License
 */

(function(e,t){function n(e,t,n){var r=e.children(),i=!1;e.empty();for(var o=0,u=r.length;o<u;o++){var a=r.eq(o);e.append(a),n&&e.append(n);if(s(e,t)){a.remove(),i=!0;break}n&&n.detach()}return i}function r(t,n,o,u,a){var f=t.contents(),l=!1;t.empty();var c="table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style";for(var h=0,p=f.length;h<p;h++){if(l)break;var d=f[h],v=e(d);if(typeof d=="undefined"||d.nodeType==3&&e.trim(d.data).length==0)continue;t.append(v),a&&t[t.is(c)?"after":"append"](a),s(o,u)&&(d.nodeType==3?l=i(v,n,o,u,a):l=r(v,n,o,u,a),l||(v.remove(),l=!0)),l||a&&a.detach()}return l}function i(t,n,r,i,u){var l=t[0];if(!l)return!1;var h=f(l),p=h.indexOf(" ")!==-1?" ":"　",d=i.wrap=="letter"?"":p,v=h.split(d),m=-1,g=-1,y=0,b=v.length-1;while(y<=b&&(y!=0||b!=0)){var w=Math.floor((y+b)/2);if(w==g)break;g=w,a(l,v.slice(0,g+1).join(d)+i.ellipsis),s(r,i)?b=g:(m=g,y=g),b==y&&b==0&&i.fallbackToLetter&&(d="",v=v[0].split(d),m=-1,g=-1,y=0,b=v.length-1)}if(m==-1||v.length==1&&v[0].length==0){var E=t.parent();t.remove();var S=u&&u.closest(E).length?u.length:0;E.contents().length>S?l=c(E.contents().eq(-1-S),n):(l=c(E,n,!0),S||E.remove()),l&&(h=o(f(l),i),a(l,h),S&&u&&e(l).parent().append(u))}else h=o(v.slice(0,m+1).join(d),i),a(l,h);return!0}function s(e,t){return e.innerHeight()>t.maxHeight}function o(t,n){while(e.inArray(t.slice(-1),n.lastCharacter.remove)>-1)t=t.slice(0,-1);return e.inArray(t.slice(-1),n.lastCharacter.noEllipsis)<0&&(t+=n.ellipsis),t}function u(e){return{width:e.innerWidth(),height:e.innerHeight()}}function a(e,t){e.innerText?e.innerText=t:e.nodeValue?e.nodeValue=t:e.textContent&&(e.textContent=t)}function f(e){return e.innerText?e.innerText:e.nodeValue?e.nodeValue:e.textContent?e.textContent:""}function l(e){do e=e.previousSibling;while(e&&e.nodeType!==1&&e.nodeType!==3);return e}function c(t,n,r){var i=t&&t[0],s;if(i){if(!r){if(i.nodeType===3)return i;if(e.trim(t.text()))return c(t.contents().last(),n)}s=l(i);while(!s){t=t.parent();if(t.is(n)||!t.length)return!1;s=l(t[0])}if(s)return c(e(s),n)}return!1}function h(t,n){return t?typeof t=="string"?(t=e(t,n),t.length?t:!1):t.jquery?t:!1:!1}function p(e){var t=e.innerHeight(),n=["paddingTop","paddingBottom"];for(var r=0,i=n.length;r<i;r++){var s=parseInt(e.css(n[r]),10);isNaN(s)&&(s=0),t-=s}return t}function d(e,t){return e?(typeof t=="string"?t="dotdotdot: "+t:t=["dotdotdot:",t],typeof window.console!="undefined"&&typeof window.console.log!="undefined"&&window.console.log(t),!1):!1}if(e.fn.dotdotdot)return;e.fn.dotdotdot=function(t){if(this.length==0)return(!t||t.debug!==!1)&&d(!0,'No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){e(this).dotdotdot(t)});var i=this;i.data("dotdotdot")&&i.trigger("destroy.dot"),i.data("dotdotdot-style",i.attr("style")),i.css("word-wrap","break-word"),i.css("white-space")==="nowrap"&&i.css("white-space","normal"),i.bind_events=function(){return i.bind("update.dot",function(t,u){t.preventDefault(),t.stopPropagation(),a.maxHeight=typeof a.height=="number"?a.height:p(i),a.maxHeight+=a.tolerance;if(typeof u!="undefined"){if(typeof u=="string"||u instanceof HTMLElement)u=e("<div />").append(u).contents();u instanceof e&&(o=u)}m=i.wrapInner('<div class="dotdotdot" />').children(),m.empty().append(o.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var l=!1,c=!1;return f.afterElement&&(l=f.afterElement.clone(!0),f.afterElement.remove()),s(m,a)&&(a.wrap=="children"?c=n(m,a,l):c=r(m,i,m,a,l)),m.replaceWith(m.contents()),m=null,e.isFunction(a.callback)&&a.callback.call(i[0],c,o),f.isTruncated=c,c}).bind("isTruncated.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),typeof t=="function"&&t.call(i[0],f.isTruncated),f.isTruncated}).bind("originalContent.dot",function(e,t){return e.preventDefault(),e.stopPropagation(),typeof t=="function"&&t.call(i[0],o),o}).bind("destroy.dot",function(e){e.preventDefault(),e.stopPropagation(),i.unwatch().unbind_events().empty().append(o).attr("style",i.data("dotdotdot-style")).data("dotdotdot",!1)}),i},i.unbind_events=function(){return i.unbind(".dot"),i},i.watch=function(){i.unwatch();if(a.watch=="window"){var t=e(window),n=t.width(),r=t.height();t.bind("resize.dot"+f.dotId,function(){if(n!=t.width()||r!=t.height()||!a.windowResizeFix)n=t.width(),r=t.height(),c&&clearInterval(c),c=setTimeout(function(){i.trigger("update.dot")},10)})}else l=u(i),c=setInterval(function(){var e=u(i);if(l.width!=e.width||l.height!=e.height)i.trigger("update.dot"),l=u(i)},100);return i},i.unwatch=function(){return e(window).unbind("resize.dot"+f.dotId),c&&clearInterval(c),i};var o=i.contents(),a=e.extend(!0,{},e.fn.dotdotdot.defaults,t),f={},l={},c=null,m=null;return a.lastCharacter.remove instanceof Array||(a.lastCharacter.remove=e.fn.dotdotdot.defaultArrays.lastCharacter.remove),a.lastCharacter.noEllipsis instanceof Array||(a.lastCharacter.noEllipsis=e.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),f.afterElement=h(a.after,i),f.isTruncated=!1,f.dotId=v++,i.data("dotdotdot",!0).bind_events().trigger("update.dot"),a.watch&&i.watch(),i},e.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,debug:!1},e.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}};var v=1,m=e.fn.html;e.fn.html=function(n){return n!=t&&!e.isFunction(n)&&this.data("dotdotdot")?this.trigger("update",[n]):m.apply(this,arguments)};var g=e.fn.text;e.fn.text=function(n){return n!=t&&!e.isFunction(n)&&this.data("dotdotdot")?(n=e("<div />").text(n).html(),this.trigger("update",[n])):g.apply(this,arguments)}})(jQuery);