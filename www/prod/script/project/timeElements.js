define(["jquery","moment","extend-moment"],function(e,t,n){var a,r,i=5e3,o=80,s=0,m={timeAgo:[],elapsed:[],progressBars:[]},c=t.lang(),d=0,l={heartbeatInterval:function(){clearTimeout(r),r=setTimeout(l.heartbeat,i)},heartbeat:function(t){var n=new Date;(t===!0||n-a>i)&&(e.each(m.timeAgo,function(e,t){l.processTimeAgo(t.el,t.time)}),e.each(m.elapsed,function(e,t){l.processElapsed(t.el,t.time)}),e.each(m.progressBars,function(e,t){if(void 0!==a&&0!==t.eta){var r=n-a;t.eta-=r/1e3}l.processProgressBars(t.el,t.time,t.eta)}),a=n),l.heartbeatInterval()},addElem:function(t,n,a){t.length&&void 0===e(t).attr("data-timeElem")&&(e(t).attr("data-timeElem","true"),a.push(n))},spinIconAnimation:function(t){var n=10,a=13;e.each(e(".animate-spin"),function(t,r){var i=e(r);d>=n&&(d=0);var o=d*-a;i.css("background-position",o+"px 0px")}),t-s>o&&(d+=1,s=t),window.requestAnimationFrame(l.spinIconAnimation)},processTimeAgo:function(e,n){e.html(t.unix(n).fromServerNow())},processElapsed:function(e,a){var r=n.getServerTime().unix(),i=r-a;t.lang("waiting-en"),e.html(t.duration(i,"seconds").humanize(!0)),t.lang(c)},processProgressBars:function(e,a,r){var i=n.getServerOffset(),o=t.unix(a).startOf("second"),s=o.unix().toFixed(2),m=e.children(".percent-inner-js"),d=e.children(".time-txt-js"),l=0!==r,u=100;if(l){var f=t().add("ms",i).startOf("second").unix().toFixed(2),p=t().add("s",r).add("ms",i).startOf("second"),v=p.unix().toFixed(2),g=t(p).diff()<0;u=Math.floor(100-(v-f)/(v-s)*100),u=u.clamp(0,100),t.lang("progress-bar-en"),d.html(t(p).fromServerNow()),g&&e.addClass("overtime")}else t.lang("progress-bar-no-eta-en"),d.html(o.fromServerNow());t.lang(c),m.css("width",u+"%")}};return{init:function(){void 0===r&&(l.heartbeatInterval(),n.init()),window.requestAnimationFrame(l.spinIconAnimation)},addTimeAgoElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};l.addElem(a,r,m.timeAgo)},addElapsedElem:function(t,n){var a=e(t),r={el:a,time:parseInt(n,10)};l.addElem(a,r,m.elapsed)},addProgressBarElem:function(t,n,a){var r=e(t),i={el:r,time:parseInt(n,10),eta:parseInt(a,10)};isNaN(i.eta)&&(i.eta=0),l.addElem(r,i,m.progressBars)},updateTimeObjects:function(){l.heartbeat(!0)},clearTimeObjects:function(t){if(void 0!==t){var n=e(t).find("[data-timeelem]");e.each(m,function(t,a){m[t]=e.grep(a,function(t){var a=!1;return e.contains(document.documentElement,t.el[0])?(e.each(n,function(n,r){return e(r).is(t.el)?(a=!0,!1):!0}),a):!0},!0)})}else e.each(m,function(e){m[e]=[]})},setHeartbeat:function(e){i=e,l.heartbeatInterval()},_timeObjects:m}});
//# sourceMappingURL=timeElements.js.map