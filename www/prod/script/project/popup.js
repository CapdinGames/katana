define(["jquery","helpers","libs/jquery.form","text!templates/popups.mustache","mustache","timeElements","toastr"],function(e,t,n,o,i,r,a){var u=e("body");!function(e){e.fn.popup=function(n){var o=e(this),i=e.extend({},e.fn.popup.defaults,n);o.settings=i;var r={init:function(){r.clear(),r.createHTML()&&(i.onCreate(o),i.autoShow&&o.ready(function(){r.showPopup()}))},createHTML:function(){return o.addClass("more-info-box more-info-box-js").append("<span class='close-btn'></span>").append(i.title).attr("data-ui-popup",!0).hide(),i.url?(e.ajax(i.url).done(function(e){return o.append(e),i.onCreate(o),r.showPopup(),!0}),!1):(o.append(e("<div/>").html(i.html)),!0)},clear:function(){"true"===o.attr("data-ui-popup")&&(i.destroyAfter?(t.clearChildEvents(o),o.off(),o.remove(),delete i.title,delete i.html,o=null,e(document).off("click.popup touchstart.popup"),e(window).off("resize.popup")):o.empty())},showPopup:function(){setTimeout(function(){r.initCloseButton(),t.jCenter(o),i.center&&e(window).on("resize.popup",function(){t.jCenter(o)})},1),i.animate?o.fadeIn(i.showAnimation,function(){i.onShow(o)}):(o.show(),i.onShow(o))},hidePopup:function(){e(document).off("click.popup touchstart.popup"),e(window).off("resize.popup"),i.animate?o.fadeOut(i.hideAnimation,function(){o.hide(),r.clear(),i.onHide(o)}):(o.hide(),r.clear(),i.onHide(o))},initCloseButton:function(){e(document).on("click.popup touchstart.popup",function(t){(!o.is(t.target)&&0===o.has(t.target).length||o.find(".close-btn").is(t.target))&&o.is(":visible")&&(r.hidePopup(),e(this).unbind("click.popup touchstart.popup",t.callee))})}};return o.showPopup=function(){r.showPopup()},o.hidePopup=function(){r.hidePopup()},o.options=function(t){i=e.extend({},e.fn.popup.defaults,i,t)},o.each(function(){r.init(),i.initalized=!0})},e.fn.popup.defaults={title:"",html:void 0,url:void 0,destroyAfter:!1,autoShow:!0,center:!0,animate:!0,showAnimation:"fast",hideAnimation:"fast",onCreate:function(){return void 0},onShow:function(){return void 0},onHide:function(){return void 0}}}(jQuery);var p;return p={init:function(){p.initCodebaseBranchesPopup(e("#codebasesBtn"))},validateForm:function(t){var n=e(".command_forcebuild",t),r=":button, :hidden, :checkbox, :submit";e(".grey-btn",n).click(function(t){var a=e("input",n).not(r),u=a.filter(function(){return this.name.indexOf("revision")>=0}),p=u.filter(function(){return""===this.value});if(p.length>0&&p.length<u.length){if(u.each(function(){""===e(this).val()?e(this).addClass("not-valid"):e(this).removeClass("not-valid")}),e(".form-message",n).hide(),!e(".error-input",n).length){var c=i.render(o,{errorinput:"true",text:"Fill out the empty revision fields or clear all before submitting"}),d=e(c);e(n).prepend(d)}t.preventDefault()}})},initJSONPopup:function(n,a){var p=e(n);p.click(function(n){n.preventDefault();var p=i.render(o,a);u.append(e("<div/>").popup({title:"",html:p,onShow:function(){void 0!==a.showRunningBuilds&&t.delegateToProgressBar(e("div.more-info-box-js div.percent-outer-js")),r.updateTimeObjects()}}))})},initCodebaseBranchesPopup:function(n){var r=e(n),a=r.attr("data-codebases-url");r.click(function(n){n.preventDefault();var r=i.render(o,{preloader:"true"}),p=e(r);e("body").append(p).show(),e.get(a).done(function(n){p.remove(),requirejs(["selectors"],function(o){var i=e(n).find("#formWrapper");i.children("#getForm").attr("action",window.location.href),i.find('.blue-btn[type="submit"]').val("Update"),u.append(e("<div/>").popup({title:e('<h3 class="codebases-head" />').html("Select Branches"),html:i,destroyAfter:!0,onCreate:function(e){e.css("max-width","80%")},onShow:function(n){o.init(),t.jCenter(n),e(window).on("resize.popup",function(){t.jCenter(n)})}}))})})})},initPendingPopup:function(n){function a(){var t=i.render(o,{preloader:"true"}),n=e(t);e("body").append(n).show(),e.ajax({url:l,cache:!1,dataType:"json",success:function(t){n.remove();var a=t[0].builderURL,p="";if(a.indexOf("?")>-1){var c=a.split("?");p+=c[1]+"&",a=c[0]}p+="returnpage=builders_json",a="{0}/cancelbuild?{1}".format(a,p);var d=i.render(o,{pendingJobs:t,showPendingJobs:!0,cancelURL:a});u.append(e("<div/>").popup({html:d,destroyAfter:!0,onCreate:function(n){var o=n.find(".waiting-time-js");o.each(function(n){r.addElapsedElem(e(this),t[n].submittedAt),r.updateTimeObjects()}),n.find("form").ajaxForm({success:function(e,t,o,i){requirejs(["realtimePages"],function(t){setTimeout(function(){var n="builders";t.updateSingleRealTimeData(n,e)},300)});var r="cancelall"===i.attr("id");r||i.parent().remove(),(r||1===n.find("li").length)&&n.hidePopup()}})},onHide:function(e){r.clearTimeObjects(e)}}))}})}var p=e(n),c=encodeURIComponent(p.attr("data-builderName")),d=t.codebasesFromURL({}),s=t.urlParamsToString(d),l="/json/pending/{0}/?{1}".format(c,s);p.click(function(e){e.preventDefault(),a()})},initRunBuild:function(n,r){function c(n){function r(){a.error("There was an error when creating your build please try again later","Error",{iconClass:"failure"})}var c=d.attr("data-builder-url"),s=d.attr("data-return-page"),l=d.attr("data-builder-name"),f=d.attr("data-popup-title"),h=location.protocol+"//"+location.host+"/forms/forceBuild",m=t.codebasesFromURL({builder_url:c,builder_name:l,return_page:s}),v=i.render(o,{preloader:"true"}),b=e(v);u.append(b),b.show(),e.get(h,m).done(function(t){var o=e("<div/>").popup({title:e('<h2 class="small-head" />').text(f),html:t,destroyAfter:!0,autoShow:!1,onCreate:function(e){p.validateForm(e);var t=e.find("form"),o={beforeSubmit:function(){e.hidePopup(),b.show()},success:function(e){requirejs(["realtimePages"],function(t){var n=s.replace("_json","");t.updateSingleRealTimeData(n,e)}),b.remove(),a.info("Your build will start shortly","Info",{iconClass:"info"})},error:function(){b.remove(),r()}};t.ajaxForm(o),n&&t.ajaxSubmit(o)}});u.append(o),n||o.showPopup()}).fail(function(){r()}).always(function(){b.hide()})}var d=e(n),s=e(r);0!==d.length&&(d.click(function(e){e.preventDefault(),c(!1)}),s.click(function(e){e.preventDefault(),c(!0)}))},initArtifacts:function(t,n){var o=e(n);o.click(function(n){n.preventDefault();var o="";if(void 0!==t){e.each(t,function(e,t){o+='<li class="artifact-js"><a target="_blank" href="{1}">{0}</a></li>'.format(e,t)}),o=e("<ul/>").addClass("builders-list").html(o);var i=e("<div/>").popup({title:"<h3>Artifacts</h3>",html:o,destroyAfter:!0});u.append(i)}})}}});
//# sourceMappingURL=popup.js.map