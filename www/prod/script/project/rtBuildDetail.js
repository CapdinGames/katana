define(["jquery","realtimePages","helpers","handlebars","mustache","text!templates/build.handlebars","text!templates/builders.mustache","timeElements","popup"],function(e,t,s,a,r,i,l,n,u){var o,c=Handlebars.compile(i),d=!1,p=!1;Handlebars.registerHelper("buildCSSClass",function(e){return s.getCssClassFromStatus(e)});var f={updateArtifacts:function(t){var s,a=e("#artifacts-js").empty(),r={},i={};e.each(t.steps,function(t,s){void 0!==s.urls&&e.each(s.urls,function(e,t){"string"==typeof t&&(r[e]=t)})}),e.each(t.logs,function(e,t){2===t.length&&(t[1].indexOf(".xml")>-1||t[1].indexOf(".html")>-1)&&(i[t[0]]=t[1])}),void 0===r||0===Object.keys(r).length?a.html("No artifacts"):(s='<a class="artifact-popup artifacts-js more-info" href="#">Artifacts ({0})&nbsp;</a>'.format(Object.keys(r).length),a.html(s),u.initArtifacts(r,a.find(".artifact-popup"))),Object.keys(i).length>0&&(s="<li>Test Results</li>",e.each(i,function(e,t){s+='<li class="s-logs-js"><a href="{0}">{1}</a></li>'.format(t,e)}),s=e("<ul/>").addClass("tests-summary-list list-unstyled").html(s),a.append(s))}};return o={init:function(){var a=t.defaultRealtimeFunctions();if(a.build=o.processBuildDetailPage,t.initRealtime(a),n.setHeartbeat(1e3),""!==window.location.search){var r=e(".top");s.codeBaseBranchOverview(r)}e(".popup-btn-js-2").click(function(t){t.preventDefault();var s=e(t.target),a=s.next(".more-info-box-js").html(),r=e("body"),i=e("<div/>").popup({title:"",html:a,destroyAfter:!0});r.append(i)})},processBuildDetailPage:function(t){var s=Object.keys(t);1===s.length&&(t=t[s[0]]);var a=t.times[0],r=t.times[1],i=null!==r,l=t.eta;o.refreshIfRequired(i),o.processBuildResult(t,a,l,i),o.processSteps(t),f.updateArtifacts(t),null===r&&n.addElapsedElem(e("#elapsedTimeJs"),a),n.updateTimeObjects()},processBuildResult:function(t,a,i,u){var o=e("#buildResult");n.clearTimeObjects(o);var d="";0!==i&&(d=r.render(l,{progressBar:!0,etaStart:a,etaCurrent:i}));var p={buildResults:!0,b:t,buildIsFinished:u,progressBar:d},f=c(p);o.html(f);var m=o.find(".percent-outer-js");m.addClass("build-detail-progress"),s.delegateToProgressBar(m)},processSteps:function(t){var a="",r=e("#stepList"),i=1;e.each(t.steps,function(t,r){if(r.hidden)return!0;var l=r.isStarted,n=r.isFinished,u=r.results[0];l?l&&!n&&(u=s.cssClassesEnum.RUNNING):u=s.cssClassesEnum.NOT_STARTED,r.hasURLs=Object.keys(r.urls).length>0,e.each(r.urls,function(e,t){return void 0!==t.url?(r.hasDependency=!0,!1):!0});var o=s.getCssClassFromStatus(u),d=r.times[0],p=r.times[1],f=s.getTime(d,p),m={step:!0,index:i,stepStarted:r.isStarted,run_time:f,css_class:o,s:r,url:r.url};return a+=c(m),i+=1,!0}),r.html(a)},refreshIfRequired:function(e){!p&&d&&e&&(window.location=window.location+"#finished",window.location.reload()),p===!1&&(p=e),d=!0}}});
//# sourceMappingURL=rtBuildDetail.js.map