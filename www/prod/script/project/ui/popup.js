define(["jquery","helpers","libs/jquery.form","text!templates/popups.mustache","mustache","timeElements","toastr"],function(e,t,n,o,a,i,r){var u=e("body");!function(e){e.fn.popup=function(n){var o=e(this),a=e.extend({},e.fn.popup.defaults,n);o.settings=a;var i={init:function(){i.clear(),i.createHTML()&&(a.onCreate(o),a.autoShow&&o.ready(function(){i.showPopup()}))},createHTML:function(){return o.addClass("more-info-box more-info-box-js").append("<span class='close-btn'></span>").append(a.title).attr("data-ui-popup",!0).hide(),a.url?(e.ajax(a.url).done(function(e){return o.append(e),a.onCreate(o),i.showPopup(),!0}),!1):(o.append(e("<div/>").html(a.html)),!0)},clear:function(){"true"===o.attr("data-ui-popup")&&(a.destroyAfter?(t.clearChildEvents(o),o.off(),o.remove(),delete a.title,delete a.html,o=null,e(document).off("click.katana.popup touchstart.katana.popup"),e(window).off("resize.katana.popup")):o.empty())},showPopup:function(){setTimeout(function(){i.initCloseButton(),t.jCenter(o),a.center&&e(window).on("resize.katana.popup",function(){t.jCenter(o)})},1),a.animate?o.fadeIn(a.showAnimation,function(){a.onShow(o)}):(o.show(),a.onShow(o))},hidePopup:function(){e(document).off("click.katana.popup touchstart.katana.popup"),e(window).off("resize.katana.popup"),a.animate?o.fadeOut(a.hideAnimation,function(){o.hide(),i.clear(),a.onHide(o)}):(o.hide(),i.clear(),a.onHide(o))},initCloseButton:function(){e(document).on("click.katana.popup touchstart.katana.popup",function(t){(!o.is(t.target)&&0===o.has(t.target).length||o.find(".close-btn").is(t.target))&&o.is(":visible")&&(i.hidePopup(),e(this).off("click.katana.popup touchstart.katana.popup",t.callee))})}};return o.showPopup=function(){i.showPopup()},o.hidePopup=function(){i.hidePopup()},o.options=function(t){a=e.extend({},e.fn.popup.defaults,a,t)},o.each(function(){i.init(),a.initalized=!0})},e.fn.popup.defaults={title:"",html:void 0,url:void 0,destroyAfter:!1,autoShow:!0,center:!0,animate:!0,showAnimation:"fast",hideAnimation:"fast",onCreate:function(){return void 0},onShow:function(){return void 0},onHide:function(){return void 0}}}(jQuery);var l;return l={init:function(){l.initCodebaseBranchesPopup(e("#codebasesBtn"))},validateForm:function(t){var n=e(".command_forcebuild",t),i=":button, :hidden, :checkbox, :submit";e(".grey-btn",n).click(function(t){var r=e("input",n).not(i),u=r.filter(function(){return this.name.indexOf("revision")>=0}),l=u.filter(function(){return""===this.value});if(l.length>0&&l.length<u.length){if(u.each(function(){""===e(this).val()?e(this).addClass("not-valid"):e(this).removeClass("not-valid")}),e(".form-message",n).hide(),!e(".error-input",n).length){var d=a.render(o,{errorinput:"true",text:"Fill out the empty revision fields or clear all before submitting"}),p=e(d);e(n).prepend(p)}t.preventDefault()}})},initJSONPopup:function(n,r){var l=e(n);l.click(function(n){n.preventDefault();var l=a.render(o,r);u.append(e("<div/>").popup({title:"",html:l,onShow:function(){void 0!==r.showRunningBuilds&&t.delegateToProgressBar(e("div.more-info-box-js div.percent-outer-js")),i.updateTimeObjects()}}))})},initCodebaseBranchesPopup:function(n){var o=e(n),a=o.attr("data-codebases-url");o.click(function(n){n.preventDefault(),e("#preloader").preloader("showPreloader"),e.get(a).done(function(n){e("#preloader").preloader("hidePreloader"),requirejs(["selectors"],function(o){var a=e(n).find("#formWrapper");a.children("#getForm").attr("action",window.location.href),a.find('.blue-btn[type="submit"]').val("Update"),u.append(e("<div/>").popup({title:e('<h3 class="codebases-head" />').html("Select Branches"),html:a,destroyAfter:!0,onCreate:function(e){e.css("max-width","80%")},onShow:function(n){o.init(),t.jCenter(n),e(window).on("resize.popup",function(){t.jCenter(n)})}}))})})})},initPendingPopup:function(n){function r(){e("#preloader").preloader("showPreloader"),e.ajax({url:s,cache:!1,dataType:"json",success:function(t){e("#preloader").preloader("hidePreloader");var n=t[0].builderURL,r="";if(n.indexOf("?")>-1){var l=n.split("?");r+=l[1]+"&",n=l[0]}r+="returnpage=builders_json",n="{0}/cancelbuild?{1}".format(n,r);var d=a.render(o,{pendingJobs:t,showPendingJobs:!0,cancelURL:n});u.append(e("<div/>").popup({html:d,destroyAfter:!0,onCreate:function(n){var o=n.find(".waiting-time-js");o.each(function(n){i.addElapsedElem(e(this),t[n].submittedAt),i.updateTimeObjects()}),n.find("form").ajaxForm({success:function(e,t,o,a){requirejs(["realtimePages"],function(t){setTimeout(function(){var n="builders";t.updateSingleRealTimeData(n,e)},300)});var i="cancelall"===a.attr("id");i||a.parent().remove(),(i||1===n.find("li").length)&&n.hidePopup()}})},onHide:function(e){i.clearTimeObjects(e)}}))}})}var l=e(n),d=encodeURIComponent(l.attr("data-builderName")),p=t.codebasesFromURL({}),c=t.urlParamsToString(p),s="/json/pending/{0}/?{1}".format(d,c);l.click(function(e){e.preventDefault(),r()})},initRunBuild:function(n,o,a){function i(n){function o(){r.error("There was an error when creating your build please try again later","Error",{iconClass:"failure"})}var i=d.attr("data-builder-url"),p=d.attr("data-return-page"),c=d.attr("data-builder-name"),s=d.attr("data-popup-title"),f=location.protocol+"//"+location.host+"/forms/forceBuild",h=t.codebasesFromURL({builder_url:i,builder_name:c,return_page:p});e("#preloader").preloader("showPreloader"),e.get(f,h).done(function(t){var d=e("<div/>").popup({title:e('<h2 class="small-head" />').text(s),html:t,destroyAfter:!0,autoShow:!1,onCreate:function(t){l.validateForm(t);var u=t.find("form"),d={beforeSubmit:function(){t.hidePopup(),e("#preloader").preloader("hidePreloader")},success:function(t){a&&(window.location.href=i),requirejs(["realtimePages"],function(e){var n=p.replace("_json","");e.updateSingleRealTimeData(n,t)}),e("#preloader").preloader("hidePreloader"),r.info("Your build will start shortly","Info",{iconClass:"info"})},error:function(){e("#preloader").preloader("hidePreloader"),o()}};u.ajaxForm(d),n&&u.ajaxSubmit(d)}});u.append(d),n||d.showPopup()}).fail(function(){o()}).always(function(){e("#preloader").preloader("hidePreloader")})}var d=e(n),p=e(o);0!==d.length&&(d.click(function(e){e.preventDefault(),i(!1)}),p.click(function(e){e.preventDefault(),i(!0)}))},initArtifacts:function(t,n){var o=e(n);o.click(function(n){n.preventDefault();var o="";if(void 0!==t){e.each(t,function(e,t){o+='<li class="artifact-js"><a target="_blank" href="{1}">{0}</a></li>'.format(e,t)}),o=e("<ul/>").addClass("builders-list").html(o);var a=e("<div/>").popup({title:"<h3>Artifacts</h3>",html:o,destroyAfter:!0});u.append(a)}})}}});
//# sourceMappingURL=popup.js.map