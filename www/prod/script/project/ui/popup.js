define(["jquery","helpers","libs/jquery.form","text!templates/popups.mustache","mustache","timeElements","toastr"],function(e,t,n,o,i,r,a){var u=e("body");!function(e){e.fn.popup=function(n){var o=e(this),i=e.extend({},e.fn.popup.defaults,n);o.settings=i;var r={init:function(){r.clear(),r.createHTML()&&(i.onCreate(o),i.autoShow&&o.ready(function(){r.showPopup()}))},createHTML:function(){return o.addClass("more-info-box more-info-box-js").append("<span class='close-btn'></span>").append(i.title).attr("data-ui-popup",!0).hide(),i.url?(e.ajax(i.url).done(function(e){return o.append(e),i.onCreate(o),r.showPopup(),!0}),!1):(o.append(e("<div/>").html(i.html)),!0)},clear:function(){"true"===o.attr("data-ui-popup")&&(i.destroyAfter?(t.clearChildEvents(o),o.off(),o.remove(),delete i.title,delete i.html,o=null,e(document).off("click.popup touchstart.popup"),e(window).off("resize.popup")):o.empty())},showPopup:function(){setTimeout(function(){r.initCloseButton(),t.jCenter(o),i.center&&e(window).on("resize.popup",function(){t.jCenter(o)})},1),i.animate?o.fadeIn(i.showAnimation,function(){i.onShow(o)}):(o.show(),i.onShow(o))},hidePopup:function(){e(document).off("click.popup touchstart.popup"),e(window).off("resize.popup"),i.animate?o.fadeOut(i.hideAnimation,function(){o.hide(),r.clear(),i.onHide(o)}):(o.hide(),r.clear(),i.onHide(o))},initCloseButton:function(){e(document).on("click.popup touchstart.popup",function(t){(!o.is(t.target)&&0===o.has(t.target).length||o.find(".close-btn").is(t.target))&&o.is(":visible")&&(r.hidePopup(),e(this).unbind("click.popup touchstart.popup",t.callee))})}};return o.showPopup=function(){r.showPopup()},o.hidePopup=function(){r.hidePopup()},o.options=function(t){i=e.extend({},e.fn.popup.defaults,i,t)},o.each(function(){r.init(),i.initalized=!0})},e.fn.popup.defaults={title:"",html:void 0,url:void 0,destroyAfter:!1,autoShow:!0,center:!0,animate:!0,showAnimation:"fast",hideAnimation:"fast",onCreate:function(){return void 0},onShow:function(){return void 0},onHide:function(){return void 0}}}(jQuery);var l;return l={init:function(){l.initCodebaseBranchesPopup(e("#codebasesBtn"))},validateForm:function(t){var n=e(".command_forcebuild",t),r=":button, :hidden, :checkbox, :submit";e(".grey-btn",n).click(function(t){var a=e("input",n).not(r),u=a.filter(function(){return this.name.indexOf("revision")>=0}),l=u.filter(function(){return""===this.value});if(l.length>0&&l.length<u.length){if(u.each(function(){""===e(this).val()?e(this).addClass("not-valid"):e(this).removeClass("not-valid")}),e(".form-message",n).hide(),!e(".error-input",n).length){var d=i.render(o,{errorinput:"true",text:"Fill out the empty revision fields or clear all before submitting"}),p=e(d);e(n).prepend(p)}t.preventDefault()}})},initJSONPopup:function(n,a){var l=e(n);l.click(function(n){n.preventDefault();var l=i.render(o,a);u.append(e("<div/>").popup({title:"",html:l,onShow:function(){void 0!==a.showRunningBuilds&&t.delegateToProgressBar(e("div.more-info-box-js div.percent-outer-js")),r.updateTimeObjects()}}))})},initCodebaseBranchesPopup:function(n){var o=e(n),i=o.attr("data-codebases-url");o.click(function(n){n.preventDefault(),e("#preloader").preloader("showPreloader"),e.get(i).done(function(n){e("#preloader").preloader("hidePreloader"),requirejs(["selectors"],function(o){var i=e(n).find("#formWrapper");i.children("#getForm").attr("action",window.location.href),i.find('.blue-btn[type="submit"]').val("Update"),u.append(e("<div/>").popup({title:e('<h3 class="codebases-head" />').html("Select Branches"),html:i,destroyAfter:!0,onCreate:function(e){e.css("max-width","80%")},onShow:function(n){o.init(),t.jCenter(n),e(window).on("resize.popup",function(){t.jCenter(n)})}}))})})})},initPendingPopup:function(n){function a(){e("#preloader").preloader("showPreloader"),e.ajax({url:s,cache:!1,dataType:"json",success:function(t){e("#preloader").preloader("hidePreloader");var n=t[0].builderURL,a="";if(n.indexOf("?")>-1){var l=n.split("?");a+=l[1]+"&",n=l[0]}a+="returnpage=builders_json",n="{0}/cancelbuild?{1}".format(n,a);var d=i.render(o,{pendingJobs:t,showPendingJobs:!0,cancelURL:n});u.append(e("<div/>").popup({html:d,destroyAfter:!0,onCreate:function(n){var o=n.find(".waiting-time-js");o.each(function(n){r.addElapsedElem(e(this),t[n].submittedAt),r.updateTimeObjects()}),n.find("form").ajaxForm({success:function(e,t,o,i){requirejs(["realtimePages"],function(t){setTimeout(function(){var n="builders";t.updateSingleRealTimeData(n,e)},300)});var r="cancelall"===i.attr("id");r||i.parent().remove(),(r||1===n.find("li").length)&&n.hidePopup()}})},onHide:function(e){r.clearTimeObjects(e)}}))}})}var l=e(n),d=encodeURIComponent(l.attr("data-builderName")),p=t.codebasesFromURL({}),c=t.urlParamsToString(p),s="/json/pending/{0}/?{1}".format(d,c);l.click(function(e){e.preventDefault(),a()})},initRunBuild:function(n,o){function i(n){function o(){a.error("There was an error when creating your build please try again later","Error",{iconClass:"failure"})}var i=r.attr("data-builder-url"),d=r.attr("data-return-page"),p=r.attr("data-builder-name"),c=r.attr("data-popup-title"),s=location.protocol+"//"+location.host+"/forms/forceBuild",f=t.codebasesFromURL({builder_url:i,builder_name:p,return_page:d});e("#preloader").preloader("showPreloader"),e.get(s,f).done(function(t){var i=e("<div/>").popup({title:e('<h2 class="small-head" />').text(c),html:t,destroyAfter:!0,autoShow:!1,onCreate:function(t){l.validateForm(t);var i=t.find("form"),r={beforeSubmit:function(){t.hidePopup(),e("#preloader").preloader("hidePreloader")},success:function(t){requirejs(["realtimePages"],function(e){var n=d.replace("_json","");e.updateSingleRealTimeData(n,t)}),e("#preloader").preloader("hidePreloader"),a.info("Your build will start shortly","Info",{iconClass:"info"})},error:function(){e("#preloader").preloader("hidePreloader"),o()}};i.ajaxForm(r),n&&i.ajaxSubmit(r)}});u.append(i),n||i.showPopup()}).fail(function(){o()}).always(function(){e("#preloader").preloader("hidePreloader")})}var r=e(n),d=e(o);0!==r.length&&(r.click(function(e){e.preventDefault(),i(!1)}),d.click(function(e){e.preventDefault(),i(!0)}))},initArtifacts:function(t,n){var o=e(n);o.click(function(n){n.preventDefault();var o="";if(void 0!==t){e.each(t,function(e,t){o+='<li class="artifact-js"><a target="_blank" href="{1}">{0}</a></li>'.format(e,t)}),o=e("<ul/>").addClass("builders-list").html(o);var i=e("<div/>").popup({title:"<h3>Artifacts</h3>",html:o,destroyAfter:!0});u.append(i)}})}}});
//# sourceMappingURL=popup.js.map